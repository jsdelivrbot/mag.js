/*
Mag.JS v0.22.9
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,t,n){function i(e,n){if(v[e]&&!n)return v[e];var i=t.getElementById(e);return i&&(v[e]=i),i}var r={values:[],attributes:[],elementMatcher:[]};e.create=function(t,n,i){return function(r,o){return"string"!=typeof r&&(o=r,r=0),e.module(r||t,n,e.utils.merge(i||{},o||{}))}},e.module=function(t,n,r){if(r=r||{},!e.utils.items.isItem(t)||!w(e.utils.items.getItem(t),i(t))){var o;o=r.key&&e.utils.items.isItem(t+"."+r.key)?e.utils.items.getItem(t+"."+r.key):e.utils.getItemInstanceId(r.key?t+"."+r.key:t),r.retain||e.mod.clear(o),e.mod.submodule(t,o,n,r);var a=i(t);if(m(o,t),!e.utils.callLCEvent("willload",e.mod.getState(o),a,o,1))return b(o),e.redraw(a,o,1),e.utils.callLCEvent("didload",e.mod.getState(o),a,o,1),g(o,a,n,e.utils.copy(r))}};var o=function(t,n){return 0>n||n!=e.utils.items.getItem(t)?t==e.mod.getId(n)?!0:!1:!0},a=[];e.begin=function(e){n===a[e]?a[e]=1:a[e]++},e.end=function(t){if(a[t]>1)a[t]--;else{a[t]=0;var n=e.utils.items.getItemVal(t);e.redraw(i(n),t)}};var u=[];e.redraw=function(t,i,r){if(!a[i]){if(!t||n===i)throw Error("Mag.JS - Id or node invalid: "+e.utils.items.getItemVal(i));if(!o(t.id,i))return;r&&e.fill.configs.splice(0,e.fill.configs.length),r&&e.mod.clear(i);var l=p(t,i,r);cancelAnimationFrame(u[i]),u[i]=requestAnimationFrame(l)}},e.hookin=function(e,t,n){r[e].push({context:{},handler:n,key:t})},e.hook=function(t,n,i){for(var o=0,a=r[t].length;a>o;o++)e.utils.callHook(r,n,t,o,i)};var l={},d=[],c=function(t,n){e.utils.onLCEvent("didupdate",t,function(i,r){var o=e.utils.merge(e.utils.copy(r),e.utils.copy(i));JSON.stringify(o)!==JSON.stringify(d[t])&&(d[t]=o,n(i,r,d[t]))})},f=[],s=function(t,n,i,r,o){e.mod.submodule(t.id,e.utils.items.getItem(n),r,i),m(e.utils.items.getItem(n),t.id),e.redraw(t,e.utils.items.getItem(n),o)},g=function(t,n,i,r){f[t]=f[t]||[];var o=function(t,n,i,r,o){"object"==typeof o&&(r=e.utils.merge(e.utils.copy(r)||{},o),e.utils.callLCEvent("willgetprops",e.mod.getState(t),n,t,0,r),o=0);var a=n.id+(r.key?"."+r.key:"")+"."+(o||0),u=l[a]||{};if(u.id=a,e.utils.items.isItem(a))return s(u,a,r,i),u;if(l[a]=u=n.cloneNode(1),u.id=a,u instanceof HTMLElement){var d=e.utils.getItemInstanceId(u.id);return f[t].push({instanceId:d,subscribe:c.bind({},d)}),s(u,a,r,i,1),u}}.bind({},t,n,i,r);return o.clones=function(e){return f[e]}.bind({},t),o.getId=function(e){return e}.bind({},t),o.draw=function(t,n,i){e.redraw(t,n,i)}.bind({},n,t),o.getState=function(t,n){return e.mod.getState(n||t)}.bind({},t),o.getProps=function(t,n){return e.mod.getProps(n||t)}.bind({},t),o.subscribe=c.bind({},t),o},v=[],m=function(t,n){var r=function(t,n){i(n)?e.redraw(i(n),t):e.utils.items.isItem(n)&&e.clear(t)}.bind({},t,n);e.mod.setFrameId(t,r)};e.clear=function(t){cancelAnimationFrame(u[t]),e.utils.items.removeItem(t),e.mod.clear(t),e.fill.clearCache(e.mod.getId(t))};var p=function(t,n,r){return function(t,n,r){if(i(t.id,1),o(t.id,n)&&t){var a=e.mod.getState(n);if(!e.utils.callLCEvent("isupdate",a,t,n)){var u=e.mod.getProps(n),l=e.utils.merge(e.utils.copy(u),e.utils.copy(a));if(e.mod.iscached(n,l)&&!r)return 0;if(!e.utils.callLCEvent("willupdate",a,t,n)&&(e.mod.callView(t,n),e.fill.setId(t.id),e.fill.run(t,a),y(t.id,e.fill.configs),I(t.id,n),e.utils.callLCEvent("didupdate",a,t,n),t&&t.parentNode)){var d=h(t.parentNode);d&&e.redraw(d,e.utils.items.getItem(d.id))}}}}.bind({},t,n,r)},h=function(e){return e.id?e:e.parentNode?h(e.parentNode):n},y=function(e,t){for(var n in t)n.indexOf('id("'+e+'")/')>-1&&t[n]()},b=function(t){var n=e.mod.getState(t);e.utils.unloaders[t]=e.utils.unloaders[t]||[],n.onunload&&e.utils.unloaders[t].push({controller:n,handler:n.onunload})},I=function(t,n){for(var i in e.fill.cached)i.indexOf('id("'+t+'")/')>-1&&i.indexOf("-config")>-1&&e.fill.cached[i].configContext&&(e.utils.unloaders[n]=e.utils.unloaders[n]||[],e.utils.unloaders[n].push({controller:e.fill.cached[i].configContext,handler:e.fill.cached[i].configContext.onunload}))},w=function(t,n){return e.utils.callLCEvent("onreload",e.mod.getState(t),n,t)};e.getNode=i,window.mag=e}(window.mag||{},document),function(e){"use strict";function t(t,n){var i=t.name;if(void 0===t.object[t.name]){var r,o=e.fill.find(n,i),a="$"===i[0],u=[];return o.reverse().forEach(function(e,t){o[t]&&(o[t].value&&o[t].value.length>0?(r=o[t].value,!o[t].type||"checkbox"!=o[t].type&&"radio"!=o[t].type||(r={_value:r,_checked:o[t].checked},u.push(r))):o[t].innerText&&o[t].innerText.length>0?r=o[t].innerText:o[0].innerHTML&&o[t].innerHTML.length>0&&(r=o[t].innerHTML))}),u.length>0&&a?u:r}}function n(n,i){var l;if("undefined"!=typeof Proxy){var d=function(n,i,l){var d=JSON.stringify(l.object),c=String(l.name);if(d!==a[i+c]){if(a[i+c]=d,"get"!=l.type||"props"==n||~e.fill.ignorekeys.indexOf(String(l.name))||void 0!==l.oldValue||0!==Object.keys(l.object).length){if("set"==l.type&&l.oldValue&&"function"==typeof l.oldValue.draw&&l.object[l.name]&&!l.object[l.name].draw){var f=l.oldValue.getId();e.utils.callLCEvent("onunload",e.mod.getState(f),e.getNode(e.mod.getId(f)),f),e.clear(f),l.oldValue.clones().length=0}}else{var s=t(l,document.getElementById(r.getId(i)));if(void 0!==s)return u[i]=0,s}var g=r.getFrameId(i);"function"==typeof g&&"set"==l.type&&(cancelAnimationFrame(o[i]),o[i]=requestAnimationFrame(g))}},c=r.getProps(i),f=e.proxy(c,d.bind({},"props",i));r.setProps(i,f);var s=e.proxy({},d.bind({},"state",i));l=new n(s)}else l=new n({});return l}var i=[],r={cache:[]};r.getState=function(e){return i[e][1]},r.setState=function(e,t){i[e][1]=t},r.getView=function(e){return i[e][0]},r.getProps=function(e){return i[e][2]},r.setProps=function(e,t){return i[e][2]=t},r.remove=function(e){i.splice(e,1)},r.getId=function(e){return i[e]&&i[e][3]},r.exists=function(e){return void 0!==i[e]?!0:!1},r.setFrameId=function(e,t){i[e][4]=t},r.getFrameId=function(e){return i[e][4]},r.submodule=function(e,t,o,a){if(i[t])return r.setProps(t,a),i[t];i[t]=[0,0,0,0,0],r.setProps(t,a);var u=function(e){return(o.controller||function(){}).call(e,r.getProps(t))||e},l=function(e,t,n){o.view.call(o,t,r.getProps(e),n)}.bind({},t),d={controller:u,view:l};return i[t][0]=d.view,i[t][1]=n(d.controller,t,e),i[t][3]=e,i[t]};var o=[],a=[];r.iscached=function(e,t){return r.cache[e]&&r.cache[e]===JSON.stringify(t)?!0:void(r.cache[e]=JSON.stringify(t))},r.clear=function(e){e>-1&&r.cache[e]&&r.cache.splice(e,1)};var u=[];r.callView=function(t,n){var i=r.getView(n);u[n]||(e.props.attachToArgs(n,r.getState(n),t),u[n]=1),i(r.getState(n),t)},e.mod=r}(window.mag||{}),function(e){"use strict";function t(e){for(var t in e)if(e[t]&&-1!==["INPUT","SELECT","TEXTAREA"].indexOf(e[t].tagName))return e[t];return!1}var n={},i="__magnum__",r=function(t,n){for(var i=1;i<t.length;i+=2){var r=t[i],o=t[i+1];n=e.fill.find(n,r),n=n[o]}return n},o=function(n,o,a,u){var l,d=(""+a).split(".");if(d.length<3){var c=parseInt(d.pop()),f=isNaN(c)?0:c;l=e.fill.find(u[f]?u[f]:u,o)}else u=r(d,u),l=e.fill.find(u,o);var s=t(l);if(s&&!s.eventOnFocus){var g=["radio","checkbox"].indexOf(s.type)>-1,v=function(t,r){this[i]=this[i]||{},this[i].dirty||(this[i].dirty=1),r&&(n._checked=this.checked,e.redraw(t,e.utils.items.getItem(t.id),1))}.bind(s,u,g);g?s.addEventListener("click",v,!1):s.addEventListener("focus",v,!1),s.eventOnFocus=1}return s},a=function(n,r,a,u){var l=a[r];"_value"===r&&(r=n.split(".").pop());var d=e.fill.find(u,r),c=t(d);if("function"!=typeof l&&c){var f=o.bind({},a,r,n,u);f(),Object.defineProperty(a,r,{configurable:!0,get:function(){var t=f();return t&&"undefined"!==t.value&&t[i]&&t[i].dirty&&t.value!==l?(l=t.value,e.redraw(u,n,1),t.value):l},set:function(e){var t=f();t&&"undefined"!==t.value&&t.value!==e&&e!==l&&(t.value=e,l=e)}})}},u=function(e,t,n){for(var i in t){var r=t[i];"object"==typeof r?u(e+"."+i,r,n):a.bind({},e,i,t,n)()}};n.attachToArgs=u,e.props=n}(window.mag||{},window),function(e){"use strict";var t={};t.callHook=function(e,t,n,i,r,o){r.change=!1,e[n][i].key==t&&(o=JSON.stringify({v:r.value,k:r.key}),e[n][i].handler.call(e[n][i].context,r),o!==JSON.stringify({v:r.value,k:r.key})&&(r.change=!0))},t.unloaders=[];var n=[];t.onLCEvent=function(e,t,i){n[e+"-"+t]=i},t.callLCEvent=function(i,r,o,a,u,l){var d=!1,c={preventDefault:function(){d=!0}};if(r&&r[i]&&(r[i].call(r,c,o,e.mod.getProps(a),l),u&&(r[i]=0)),n[i+"-"+a]&&n[i+"-"+a](e.mod.getState(a),e.mod.getProps(a)),d)for(var f,s=0,g=t.unloaders[a];f=g&&g[s];s++)f.controller.onunload&&(f.handler.call(f.controller,o),f.controller.onunload=0);return d},t.copy=function(e){return Object.assign({},e)},t.merge=function(e,t){return Object.assign(e,t)};var i={i:[],isItem:function(e){return i.i.indexOf(e)>-1},setItem:function(e){i.i[i.i.length]=e},getItem:function(e){return i.i.indexOf(e)},getItemVal:function(e){return i.i[e]},removeItem:function(e){i.i.splice(i.i.indexOf(e),1)}};t.items=i,t.getItemInstanceIdAll=function(){return i.i},t.getItemInstanceId=function(e){return i.isItem(e)?i.getItem(e):(i.setItem(e),i.getItem(e))},e.utils=t}(window.mag||{}),function(e,t,n,i){"use strict";function r(e){return Array.isArray&&Array.isArray(e)||"[object Array]"==={}.toString.call(e)}function o(e,t){return e[E]=e[E]||{},(!e[E].uid||t)&&(e[E].uid=performance.now()),e[E].uid}function a(e,t){var n=o(e,t);return P[n]?P[n]:P[n]=d(e)}function u(e,t,n){var r=o(e,n);return V[_.id]=V[_.id]||[],V[_.id][r]&&V[_.id][r]==t?1:(V[_.id][r]=t,i)}function l(e){return e.id?e:e.parentNode?l(e.parentNode):i}function d(e){var t="",n=l(e),i=e.parentNode&&[].indexOf.call(e.parentNode.children,e);return n&&(t+='id("'+n.id+'")'),t+="/"+e.tagName+"["+(i+1)+"]"}function c(e){if(""!==e.id)return'id("'+e.id+'")';if(e===n.body)return e.tagName;var t=0;if(e.parentNode)for(var i=e.parentNode.childNodes,r=0;r<i.length;r++){var o=i[r];if(o===e)return c(e.parentNode)+"/"+e.tagName+"["+(t+1)+"]";1===o.nodeType&&o.tagName===e.tagName&&t++}}function f(e){var t=c(e);e.parentNode.removeChild(e),T[t+"-config"]&&T[t+"-config"].configContext&&typeof T[t+"-config"].configContext.onunload===L&&T[t+"-config"].configContext.onunload(T[t+"-config"].configContext,e,t)}function s(e){var t=e&&parseInt(e.split("[").pop().slice(0,-1));return t?parseInt(t)-1:0}function g(e){return e&&e.indexOf("id(")>-1&&e.split('id("')[1].split('")')[0]}function v(e){return e&&e[E]&&e[E].isChildOfArray?e:e.parentNode?v(e.parentNode):i}function m(e,t,i){if(!u(e,t.outerHTML,i)&&!n.getElementById(t.id)){for(;e.lastChild;)e.removeChild(e.lastChild);e.appendChild(t)}}function p(t,n,o){var a,u,l=s(o);if(n&&n.nodeType==S)return m(t,n),i;if("function"==typeof n){var d=v(t.parentNode),c=d&&d.getAttribute("key");d&&c&&(l=+c.split(E)[1]);var f=n(l);if(f&&f.nodeType&&f.nodeType==S)return m(t,f),t[E]=t[E]||{},t[E].isChildOfArray=!0,t[E].dataPass={index:l},i;var g=/<[a-z][\s\S]*>/i.test(f)?"_html":"_text",b={};return b[g]=f,p(t,b,o)}if("object"!=typeof n)return p(t,{_text:n},o);for(var c in n){var I=n[c];I===i?I="":null===I&&-1===["onunload"].indexOf(c)?(t[E].detached=t[E].detached||[],t[E].detached[c]=1,y(t,c)):t[E].detached&&t[E].detached[c]&&(h(t,c),t[E].detached[c]=0),"_"===c[0]&&(a=a||{},a[c.substr(1)]=I)}a&&w(t,a,o);for(var c in n){var I=n[c];if(!~_.ignorekeys.indexOf(c)&&"_"!==c[0]){u=k(t,c);var x={key:c,value:I,node:t};e.hook("values","*",x),x.change&&(I=x.value),r(I)&&(u=k(t,"$"+c)),_.run(u,I,o+"/"+c)}}}function h(e,t){var n=k(e,t);n.forEach(function(e){var t=o(e);if(F[t]){for(var n in F[t])e.appendChild(F[t][n]);delete F[t]}})}function y(e,t){var n=k(e,t);n.forEach(function(e){var t=o(e);for(e.children.length&&(F[t]=b(e.children));e.lastChild;)f(e.lastChild)})}function b(e){var t;if(null==e.length&&(e=[e]),!r(e)){t=[];for(var n=0;n<e.length;n+=1)e[n]&&t.push(e[n]);e=t}return e}function I(t,i,r){var o=function(t,i,r){var o=v(i),u=o&&c(o),l=s(u),d=a(i),f=s(d),m={path:u,data:((o||{})[E]||[]).dataPass,node:o,index:l},p=g(d),h=n.getElementById(p),y=t.call(i,r,f,i,m);return e.redraw(h,e.utils.items.getItem(p),1),y}.bind({},i[r],t);return o}function w(n,i,r){var o=s(r);for(var a in i)if("text"!==a&&"html"!==a)if(0==a.indexOf("on"))n[a.toLowerCase()]=I(n,i,a);else{if("config"==a){var r=c(n),o=s(r),u=!0;T[r+"-config"]?u=!1:T[r+"-config"]={};var l=T[r+"-config"].configContext=T[r+"-config"].configContext||{},d=function(e,t){return function(){return e.apply(e,t)}};t[r]=d(i[a],[n,u,l,o]);continue}var f={key:a,value:i[a],node:n};e.hook("attributes",a,f),f.change&&(a=f.key,i[a]=f.value),null===i[a]?n.removeAttribute(a):(a in n&&(n[a]=i[a]),n.setAttribute(a,""+i[a]))}x(n,i.text),N(n,i.html)}function x(e,t){var n,i;if(e&&null!=t&&!u(e,t)){if(!i){i=[];for(var r=0;r<e.childNodes.length;r+=1)n=e.childNodes[r],n.nodeType===S&&i.push(n)}for(;e.lastChild;)e.removeChild(e.lastChild);"INPUT"===e.nodeName?e.value=""+t:e.appendChild(e.ownerDocument.createTextNode(""+t));for(var r=0;r<i.length;r+=1)e.appendChild(i[r]);"SELECT"===e.nodeName&&(e.value=""+t)}}function N(e,t){e&&null!=t&&!u(e,t)&&(e.innerHTML=t)}function k(t,n,i){var r=C(t),o=[],a=n,u="$"===n[0];"$"===a[0]&&(a=a.substr(1));for(var l=0;l<r.length;l+=1)O(r[l],a)&&o.push(r[l]);if(!o.length||u)for(var l=0;l<r.length&&(o=o.concat(k(r[l],n,!0)),!o.length||u);l++);if(!i&&!o.length){var d={key:n,value:o,node:t};e.hook("elementMatcher",n,d),d.change&&(o=d.value)}return o}function C(e){var t=[];if(e){var n=e.childNodes;if(n)for(var i=0;i<n.length;i+=1)n[i].nodeType===S&&t.push(n[i])}return t}function O(e,t){var n=" "+e.className+" ";return e.id===t||n.indexOf(" "+t+" ")>-1||e.name===t||e.nodeName.toLowerCase()===t.toLowerCase()||e.getAttribute("data-bind")===t}var _={ignorekeys:["willgetprops","Symbol(Symbol.toStringTag)","nodeType","toJSON","onunload","onreload","willupdate","didupdate","didload","willload","isupdate"]},S=1,T=[],E="__magnum__",L="function",j="undefined",A="_key",P=[],V=[],M={};_.run=function(e,t,n){var o,u,l;if(e){null==t&&(t={_text:""});var d=b(e);if(l=r(t)){if(M[n]&&0===d.length&&(M[n].parent.insertAdjacentHTML("beforeend",M[n].node),d=b(M[n].parent.children)),0===d.length)return;for(u=d[0].parentNode,M[n]||(M[n]={node:d[0].cloneNode(1).outerHTML,parent:u});d.length<t.length;)M[n]?(u.insertAdjacentHTML("beforeend",M[n].node),o=u.lastChild):o=d[0].cloneNode(1),d.push(o),u&&u.appendChild(o);var c=(d.map(function(e){return e.__key}),t.map(function(e){return e&&e[A]}));if(d.length==t.length||-1!==c.indexOf(i))var t=t.map(function(e,t){if("object"==typeof e){if(d[t].__key&&typeof e[A]===j)return e[A]=d[t].__key,e;typeof e[A]===j&&(e[A]=E+t),d[t].__key=e[A]}return e});if(d.length>t.length)if(0===t.length||"object"!=typeof t[0])for(;d.length>t.length;)o=d.pop(),u=o.parentNode,u&&f(o);else var s=[],g=t.map(function(e){return e[A]}),d=(d.map(function(e){return e.__key}),d.filter(function(e){return-1===g.indexOf(e.__key)||-1!==s.indexOf(e.__key)?(s.push(e.__key),f(e),!1):(s.push(e.__key),!0)}))}for(var v=0;v<d.length;v++)if(l)d[v]&&_.run(d[v],t[v]);else{t&&"object"==typeof t&&-1!==Object.keys(t).indexOf(A)&&(d[v][E]=d[v][E]||{},d[v][E].isChildOfArray=!0,d[v][E].dataPass=t);var m=a(d[v]);p(d[v],t,m)}return e}};var F=[];_.configs=t,_.find=k,_.setId=function(e){_.id=e},_.clearCache=function(e){V[e]&&delete V[e]},e.fill=_}(window.mag||{},[],document),function(e,t){function n(t,n){var i=[];return new Proxy(t,{get:function(t,r){var o=t[r],a=n({type:"get",object:e.utils.copy(t[r]),name:r,oldValue:i[r]});return void 0!==a&&(o=t[r]=a),o},deleteProperty:function(e,t){return n({type:"delete",name:t,object:e,oldValue:i[t]}),delete e[t]},set:function(t,r,o){return JSON.stringify(o)!==JSON.stringify(t[r])&&(i[r]=e.utils.copy(t[r])),n({type:"set",name:r,object:t,oldValue:i[r]}),t[r]=o,!0}})}function i(e,t){for(var i in e)Array.isArray(e[i])&&e[i].length<101&&(e[i]=n(e[i],t));return n(e,t)}e.proxy=function(n,r){if(n&&t.Proxy){var o=function(t){return"object"==typeof t.object[t.name]&&(t.object[t.name]=e.proxy(t.object[t.name],r)),r(t)};return i(n,o)}}}(window.mag||{},window);
