/*
Mag.JS v0.23.5
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,n,t){function i(n,t){if(o[n]&&!t)return o[n];var i=e.doc.getElementById(n);return i&&(o[n]=i),o[n]}e.doc=n;var r={values:[],attributes:[],elementMatcher:[]},o=[];e.create=function(n,t,i){return function(r,o){return"string"!=typeof r&&(o=r,r=0),e.module(r||n,t,e.utils.merge(i||{},o||{}))}},e.module=function(n,t,r){r=r||{},n instanceof HTMLElement&&(n.id||(n.id=performance.now()),o[n.id]=n,n=n.id);var a;if(!(a=!e.utils.items.isItem(n))){a=e.utils.items.getItem(n);var d=i(n);a=!e.utils.callLCEvent("onreload",e.mod.getState(a),d,a)}return a&&(a=r.key&&e.utils.items.isItem(n+"."+r.key)?e.utils.items.getItem(n+"."+r.key):e.utils.getItemInstanceId(r.key?n+"."+r.key:n),r.retain||e.mod.clear(a),e.mod.submodule(n,a,t,r),d=i(n),v(a,n),!e.utils.callLCEvent("willload",e.mod.getState(a),d,a,1))?(e.redraw(d,a,1),e.utils.callLCEvent("didload",e.mod.getState(a),d,a,1),m(a,d,t,e.utils.copy(r))):void 0};var a=function(n,t){return 0>t||t!=e.utils.items.getItem(n)?n==e.mod.getId(t)?!0:!1:!0},d=[];e.begin=function(e){t===d[e]?d[e]=1:d[e]++},e.end=function(n){if(1<d[n])d[n]--;else{d[n]=0;var t=e.utils.items.getItemVal(n);e.redraw(i(t),n)}};var u=[];e.redraw=function(n,i,r){if(!d[i]){if(!n||t===i)throw Error("Mag.JS - Id or node invalid: "+e.utils.items.getItemVal(i));a(n.id,i)&&(r&&e.fill.configs.splice(0,e.fill.configs.length),r&&e.mod.clear(i),n=p(n,i,r),cancelAnimationFrame(u[i]),u[i]=requestAnimationFrame(n))}},e.hookin=function(e,n,t){r[e].push({context:{},handler:t,key:n})},e.hook=function(n,t,i){for(var o=0,a=r[n].length;a>o;o++)e.utils.callHook(r,t,n,o,i)};var l={},c=[],f=function(n,t){e.utils.onLCEvent("didupdate",n,function(r,o){var a=e.utils.merge(e.utils.copy(o),e.utils.copy(r));JSON.stringify(a)!==JSON.stringify(c[n])&&(t(r,o,i(e.mod.getId(n)),c[n]),c[n]=a)})},s=[],g=function(n,t,i,r,o){t=e.utils.items.getItem(t),e.mod.submodule(n.id,t,r,i),e.utils.callLCEvent("willgetprops",e.mod.getState(t),n,t,0,i)||(v(t,n.id),e.redraw(n,t,o))},m=function(n,t,i,r){s[n]=s[n]||[];var o=function(n,t,i,r,o){if("object"==typeof o&&(r=e.utils.merge(e.utils.copy(r)||{},o),o=0),o=t.id+(r.key?"."+r.key:"")+"."+(o||0),t=l[o]=l[o]||t.cloneNode(1),t.id=o,e.utils.items.isItem(o))return g(t,o,r,i,1),t;var a=e.utils.getItemInstanceId(t.id);return s[n].push({instanceId:a,subscribe:f.bind({},a)}),g(t,o,r,i,1),t}.bind({},n,t,i,r);return o.clones=function(e){return s[e]}.bind({},n),o.destroy=function(n){var t=e.getNode(e.mod.getId(n));e.utils.callLCEvent("onunload",e.mod.getState(n),t,n),e.clear(n);for(var i=0,r=e.utils.unloaders[n];t=r&&r[i];i++)t.controller.onunload&&(t.handler.call(t.controller,node),t.controller.onunload=0);o.clones(n).length=0}.bind({},n),o.getId=function(e){return e}.bind({},n),o.draw=function(n,t,i){e.redraw(n,t,i)}.bind({},t,n),o.getState=function(n,t){return e.mod.getState(t||n)}.bind({},n),o.getProps=function(n,t){return e.mod.getProps(t||n)}.bind({},n),o.subscribe=f.bind({},n),o},v=function(n,t){var r=function(n,t){i(t)?e.redraw(i(t),n):e.utils.items.isItem(t)&&e.clear(n)}.bind({},n,t);e.mod.setFrameId(n,r)};e.clear=function(n){cancelAnimationFrame(u[n]),e.utils.items.removeItem(n),e.mod.clear(n),e.fill.clearCache(e.mod.getId(n))};var p=function(n,r,o){return function(n,r,o){if(i(n.id,1),a(n.id,r)&&n){var d=e.mod.getState(r);if(!e.utils.callLCEvent("isupdate",d,n,r)){if(e.mod.iscached(r)&&!o)n=0;else{if(!e.utils.callLCEvent("willupdate",d,n,r)){e.mod.callView(n,r),e.fill.setId(n.id),e.fill.run(n,d),o=n.id;var u,l=e.fill.configs;for(u in l)-1<u.indexOf('id("'+o+'")/')&&l[u]();u=n.id;for(var c in e.fill.cached)-1<c.indexOf('id("'+u+'")/')&&-1<c.indexOf("-config")&&e.fill.cached[c].configContext&&(e.utils.unloaders[r]=e.utils.unloaders[r]||[],e.utils.unloaders[r].push({controller:e.fill.cached[c].configContext,handler:e.fill.cached[c].configContext.onunload}));e.utils.callLCEvent("didupdate",d,n,r),e.mod.iscached(r)}n=t}return n}}}.bind({},n,r,o)};e.getNode=i,window.mag=e}(window.mag||{},document),function(e){function n(n,t){var i=n.name;if(void 0===n.object[n.name]){var r,o=e.fill.find(t,i),i="$"===i[0],a=[];return o.reverse().forEach(function(e){e&&(e.value&&0<e.value.length?(r=e.value,!e.type||"checkbox"!=e.type&&"radio"!=e.type||(r={_value:r},e.checked&&(r._checked=!0),a.push(r))):e.innerText&&0<e.innerText.length?r=e.innerText:e.innerHTML&&0<e.innerHTML.length?r=e.innerHTML:e.value||"INPUT"!=e.tagName||(r=""))}),0<a.length&&i?a:r}}function t(t,i){return new t("undefined"!=typeof Proxy?e.proxy({},function(t,i){var u=JSON.stringify(i.object),l=String(i.name);if(u!==a[t+l]){if(a[t+l]=u,"get"!=i.type||~e.fill.ignorekeys.indexOf(String(i.name))||void 0!==i.oldValue||0!==Object.keys(i.object).length)"set"==i.type&&i.object[i.name]&&i.object[i.name].draw&&"function"==typeof i.object[i.name].draw&&(r.innerMods[r.getId(t)]=[i.name,i.object[i.name]]);else if(u=n(i,e.doc.getElementById(r.getId(t))),void 0!==u)return d[t]=0,u;u=r.getFrameId(t),"function"==typeof u&&"set"==i.type&&(cancelAnimationFrame(o[t]),o[t]=requestAnimationFrame(u))}}.bind({},i)):{})}var i=[],r={innerMods:[],cache:[],getState:function(e){return i[e][1]},setState:function(e,n){i[e][1]=n},getView:function(e){return i[e][0]},getProps:function(e){return i[e][2]},setProps:function(e,n){return i[e][2]=n},remove:function(e){i.splice(e,1)},getId:function(e){return i[e]&&i[e][3]},exists:function(e){return void 0!==i[e]?!0:!1},setFrameId:function(e,n){i[e][4]=n},getFrameId:function(e){return i[e][4]},submodule:function(n,o,a,d){return i[o]?(d.key&&d.key===r.getProps(o).key?r.setProps(o,e.utils.copy(e.utils.merge(r.getProps(o),d))):r.setProps(o,d),i[o]):(i[o]=[0,0,0,0,0],r.setProps(o,d),d=function(e,n,t){a.view.call(a,n,r.getProps(e),t)}.bind({},o),i[o][0]=d,i[o][3]=n,i[o][1]=t(function(e){return(a.controller||function(){}).call(e,r.getProps(o))||e},o,n),i[o])}},o=[],a=[];r.iscached=function(n){var t=e.utils.merge(e.utils.copy(r.getProps(n)),r.getState(n));return r.cache[n]&&r.cache[n]===JSON.stringify(t)?!0:void(r.cache[n]=JSON.stringify(t))},r.clear=function(e){e>-1&&r.cache[e]&&r.cache.splice(e,1)};var d=[];r.callView=function(n,t){var i=r.getView(t);d[t]||(e.props.attachToArgs(t,r.getState(t),n),d[t]=1),i(r.getState(t),n)},e.mod=r}(window.mag||{}),function(e){function n(e){for(var n in e)if(e[n]&&-1!==["INPUT","SELECT","TEXTAREA"].indexOf(e[n].tagName))return e[n];return!1}var t={},i=function(n,t){for(var i=1;i<n.length;i+=2){var r=n[i+1];t=e.fill.find(t,n[i]),t=t[r]}return t},r=function(t,r,o,a){return o=(""+o).split("."),3>o.length?(o=parseInt(o.pop()),o=isNaN(o)?0:o,r=e.fill.find(a[o]?a[o]:a,r)):(a=i(o,a),r=e.fill.find(a,r)),(r=n(r))&&!r.eventOnFocus&&(o=-1<["radio","checkbox"].indexOf(r.type),a=function(n,i){this.__magnum__=this.__magnum__||{},this.__magnum__.dirty||(this.__magnum__.dirty=1),i&&(t._checked=this.checked,e.redraw(n,e.utils.items.getItem(n.id),1))}.bind(r,a,o),o?r.addEventListener("click",a,!1):r.addEventListener("focus",a,!1),r.eventOnFocus=1),r},o=function(t,i,o,a){var d=o[i];"_value"===i&&(i=t.split(".").pop());var u=e.fill.find(a,i),u=n(u);if("function"!=typeof d&&u){var l=r.bind({},o,i,t,a);l(),Object.defineProperty(o,i,{configurable:!0,get:function(){var n=l();return n&&"undefined"!==n.value&&n.__magnum__&&n.__magnum__.dirty&&n.value!==d?(d=n.value,e.redraw(a,t,1),n.value):d},set:function(e){var n=l();n&&"undefined"!==n.value&&n.value!==e&&e!==d&&(n.value=e,d=e)}})}},a=function(e,n,t){for(var i in n){var r=n[i];"object"==typeof r?a(e+"."+i,r,t):o.bind({},e,i,n,t)()}};t.attachToArgs=a,e.props=t}(window.mag||{},window),function(e){var n={callHook:function(e,n,t,i,r,o){r.change=!1,e[t][i].key==n&&(o=JSON.stringify({v:r.value,k:r.key}),e[t][i].handler.call(e[t][i].context,r),o!==JSON.stringify({v:r.value,k:r.key})&&(r.change=!0))},unloaders:[]},t=[];n.onLCEvent=function(e,n,i){t[e+"-"+n]=i},n.callLCEvent=function(n,i,r,o,a,d){var u=!1,l={preventDefault:function(){u=!0}};return i&&i[n]&&(i[n].call(i,l,r,e.mod.getProps(o),o,d),a&&(i[n]=0)),t[n+"-"+o]&&t[n+"-"+o](e.mod.getState(o),e.mod.getProps(o)),u},n.copy=function(e){return Object.assign({},e)},n.merge=function(){return Object.assign.apply({},arguments)};var i={i:[],isItem:function(e){return-1<i.i.indexOf(e)},setItem:function(e){i.i[i.i.length]=e},getItem:function(e){return i.i.indexOf(e)},getItemVal:function(e){return i.i[e]},removeItem:function(e){i.i.splice(i.i.indexOf(e),1)}};n.items=i,n.getItemInstanceIdAll=function(){return i.i},n.getItemInstanceId=function(e){return i.isItem(e)?i.getItem(e):(i.setItem(e),i.getItem(e))},e.utils=n}(window.mag||{}),function(e,n,t){function i(e){return Array.isArray&&Array.isArray(e)||"[object Array]"==={}.toString.call(e)}function r(e,n){return e[N]=e[N]||{},(!e[N].uid||n)&&(e[N].uid=performance.now()),e[N].uid}function o(e,n){var t=r(e,n);if(O[t])t=O[t];else{var i,o=O,a="";i=d(e);var u=e.parentNode&&[].indexOf.call(e.parentNode.children,e);i&&(a+='id("'+i.id+'")'),i=a+("/"+e.tagName+"["+(u+1)+"]"),t=o[t]=i}return t}function a(e,n,i){return e=r(e,i),S[k.id]=S[k.id]||[],S[k.id][e]&&S[k.id][e]==n?1:(S[k.id][e]=n,t)}function d(e){return e.id?e:e.parentNode?d(e.parentNode):t}function u(n){if(n.id)return'id("'+n.id+'")';if(n===e.doc.body)return n.tagName;var t=0;if(n.parentNode)for(var i=n.parentNode.childNodes,r=0;r<i.length;r++){var o=i[r];if(o===n)return u(n.parentNode)+(n.tagName?"/"+n.tagName+"["+(t+1)+"]":"");1===o.nodeType&&o.tagName===n.tagName&&t++}}function l(n){var t=u(n);n.parentNode.removeChild(n),n&&x[t+"-config"]&&x[t+"-config"].configContext&&typeof x[t+"-config"].configContext.onunload===C&&(x[t+"-config"].configContext.onunload(x[t+"-config"].configContext,n,t),delete x[t+"-config"],delete e.fill.configs[t])}function c(e){return(e=e&&parseInt(e.split("[").pop().slice(0,-1)))?parseInt(e)-1:0}function f(e){return e&&e[N]&&e[N].isChildOfArray?e:e.parentNode?f(e.parentNode):t}function s(n,t,i){if(!a(n,t.outerHTML,i)&&!e.doc.getElementById(t.id)){for(;n.lastChild;)n.removeChild(n.lastChild);n.appendChild(t)}}function g(n,r,o){var a,d=c(o);if(r&&r.nodeType==_)return s(n,r),t;if("function"==typeof r){var u=(a=f(n.parentNode))&&a.getAttribute("key");return a&&u&&(d=+u.split(N)[1]),(u=r(d))&&u.nodeType&&u.nodeType==_?(s(n,u),n[N]=n[N]||{},n[N].isChildOfArray=!0,n[N].dataPass={index:d},r.draw(),t):(r=/<[a-z][\s\S]*>/i.test(u)?"_html":"_text",d={},d[r]=u,g(n,d,o))}if("object"!=typeof r)return g(n,{_text:r},o);e.mod.innerMods[k.id]&&r[e.mod.innerMods[k.id][0]]&&!r[e.mod.innerMods[k.id][0]].draw&&e.mod.innerMods[k.id][1].destroy();for(u in r)d=r[u],d===t?d="":null===d&&-1===["onunload"].indexOf(u)?(n[N].detached=n[N].detached||[],n[N].detached[u]=1,v(n,u)):n[N].detached&&n[N].detached[u]&&(m(n,u),n[N].detached[u]=0),"_"===u[0]&&(a=a||{},a[u.substr(1)]=d);a&&y(n,a,o);for(u in r)if(d=r[u],!~k.ignorekeys.indexOf(u)&&"_"!==u[0]){a=w(n,u);var l={key:u,value:d,node:n};e.hook("values","*",l),l.change&&(d=l.value),i(d)&&(a=w(n,"$"+u)),k.run(a,d,o+"/"+u)}}function m(e,n){w(e,n).forEach(function(e){var n=r(e);if(j[n]){for(var t in j[n])e.appendChild(j[n][t]);delete j[n]}})}function v(e,n){w(e,n).forEach(function(e){var n=r(e);for(e.children.length&&(j[n]=p(e.children));e.lastChild;)l(e.lastChild)})}function p(e){var n;if(null==e.length&&(e=[e]),!i(e)){n=[];for(var t=0;t<e.length;t+=1)e[t]&&n.push(e[t]);e=n}return e}function h(n,t,i){return function(n,t,i){var r=f(t),a=r&&u(r),d=c(a),l=o(t),s=c(l),r={path:a,data:((r||{})[N]||[]).dataPass,node:r,index:d},l=l&&-1<l.indexOf("id(")&&l.split('id("')[1].split('")')[0],a=e.doc.getElementById(l);return n=n.call(t,i,s,t,r),e.redraw(a,e.utils.items.getItem(l)),n}.bind({},t[i],n)}function y(t,i,r){var o,a=c(r);for(o in i)if("text"!==o&&"html"!==o)if(0==o.indexOf("on"))t[o.toLowerCase()]=h(t,i,o);else if("config"==o){r=u(t);var a=c(r),d=!0;x[r+"-config"]?d=!1:x[r+"-config"]={};var l=x[r+"-config"].configContext=x[r+"-config"].configContext||{};n[r]=function(e,n){return function(){return e.apply(e,n)}}(i[o],[t,d,l,a])}else r={key:o,value:i[o],node:t},e.hook("attributes",o,r),r.change&&(o=r.key,i[o]=r.value),null===i[o]?t.removeAttribute(o):(o in t&&(t[o]=i[o]),t.setAttribute(o,""+i[o]));b(t,i.text),I(t,i.html)}function b(e,n){var t,i;if(e&&null!=n&&!a(e,n)){if(!i){i=[];for(var r=0;r<e.childNodes.length;r+=1)t=e.childNodes[r],t.nodeType===_&&i.push(t)}for(;e.lastChild;)e.removeChild(e.lastChild);for("INPUT"===e.nodeName?e.value=""+n:e.appendChild(e.ownerDocument.createTextNode(""+n)),r=0;r<i.length;r+=1)e.appendChild(i[r]);"SELECT"===e.nodeName&&(e.value=""+n)}}function I(e,n){e&&null!=n&&!a(e,n)&&(e.innerHTML=n)}function w(n,t,i){var r=[];if(n){var o=n.childNodes;if(o)for(var a=0;a<o.length;a+=1)o[a].nodeType===_&&r.push(o[a])}var o=[],a=t,d="$"===t[0];"$"===a[0]&&(a=a.substr(1));for(var u=0;u<r.length;u+=1){var l=r[u],c=a,f=" "+l.className+" ";(l.id===c||-1<f.indexOf(" "+c+" ")||l.name===c||l.nodeName.toLowerCase()===c.toLowerCase()||l.getAttribute("data-bind")===c)&&o.push(r[u])}if(!o.length||d)for(u=0;u<r.length&&(o=o.concat(w(r[u],t,!0)),!o.length||d);u++);return i||o.length||(n={key:t,value:o,node:n},e.hook("elementMatcher",t,n),n.change&&(o=n.value)),o}var k={cached:[],ignorekeys:"willgetprops Symbol(Symbol.toStringTag) nodeType toJSON onunload onreload willupdate didupdate didload willload isupdate".split(" ")},_=1,x=k.cached,N="__magnum__",C="function",O=[],S=[],T={};k.run=function(e,n,r){var a,d,u;if(e){null==n&&(n={_text:""});var c=p(e);if(u=i(n)){if(T[r]&&0===c.length&&(T[r].parent.insertAdjacentHTML("beforeend",T[r].node),c=p(T[r].parent.children)),0===c.length)return;for(d=c[0].parentNode,T[r]||(T[r]={node:c[0].cloneNode(1).outerHTML,parent:d});c.length<n.length;)T[r]?(d.insertAdjacentHTML("beforeend",T[r].node),a=d.lastChild):a=c[0].cloneNode(1),c.push(a),d&&d.appendChild(a);if(c.map(function(e){return e.__key}),r=n.map(function(e){return e&&e._key}),(c.length==n.length||-1!==r.indexOf(t))&&(n=n.map(function(e,n){if("object"==typeof e){if(c[n].__key&&void 0===e._key)return e._key=c[n].__key,e;void 0===e._key&&(e._key=N+n),c[n].__key=e._key}return e})),c.length>n.length)if(0===n.length||"object"!=typeof n[0])for(;c.length>n.length;)a=c.pop(),(d=a.parentNode)&&l(a);else var f=[],s=n.map(function(e){return e._key}),c=(c.map(function(e){return e.__key}),c.filter(function(e){return-1===s.indexOf(e.__key)||-1!==f.indexOf(e.__key)?(f.push(e.__key),l(e),!1):(f.push(e.__key),!0)}))}for(r=0;r<c.length;r++)u?c[r]&&k.run(c[r],n[r]):(n&&"object"==typeof n&&-1!==Object.keys(n).indexOf("_key")&&(c[r][N]=c[r][N]||{},c[r][N].isChildOfArray=!0,c[r][N].dataPass=n),a=o(c[r]),g(c[r],n,a));return e}};var j=[];k.configs=n,k.find=w,k.setId=function(e){k.id=e},k.clearCache=function(e){S[e]&&delete S[e]},e.fill=k}(window.mag||{},[]),function(e,n){function t(n,t){var i=[];return new Proxy(n,{get:function(n,r){var o=n[r],a=t({type:"get",object:e.utils.copy(n[r]),name:r,oldValue:i[r]});return void 0!==a&&(o=n[r]=a),o},deleteProperty:function(e,n){return t({type:"delete",name:n,object:e,oldValue:i[n]}),delete e[n]},set:function(n,r,o){return JSON.stringify(o)!==JSON.stringify(n[r])&&(i[r]=e.utils.copy(n[r])),t({type:"set",name:r,object:n,oldValue:i[r]}),n[r]=o,!0}})}function i(e,n){for(var i in e)Array.isArray(e[i])&&101>e[i].length&&(e[i]=t(e[i],n));return t(e,n)}e.proxy=function(t,r){return t&&n.Proxy?i(t,function(n){return"object"==typeof n.object[n.name]&&(n.object[n.name]=e.proxy(n.object[n.name],r)),r(n)}):void 0}}(window.mag||{},window);
