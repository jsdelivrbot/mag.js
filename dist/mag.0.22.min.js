/*
Mag.JS v0.22
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,t,n){function i(e,n){if(c[e]&&!n)return c[e];var i=t.getElementById(e);return i&&(c[e]=i),i}var r={values:[],attributes:[],elementMatcher:[]};e.create=function(t,n,i){return function(r,o){return"string"!=typeof r&&(o=r,r=0),e.module(r||t,n,e.utils.merge(i||{},o||{}))}},e.module=function(t,n,r){r=r||{};var o;if(!(o=!e.utils.items.isItem(t))){o=e.utils.items.getItem(t);var a=i(t);o=!e.utils.callLCEvent("onreload",e.mod.getState(o),a,o)}return o&&(o=r.key&&e.utils.items.isItem(t+"."+r.key)?e.utils.items.getItem(t+"."+r.key):e.utils.getItemInstanceId(r.key?t+"."+r.key:t),r.retain||e.mod.clear(o),e.mod.submodule(t,o,n,r),a=i(t),l(o,t),!e.utils.callLCEvent("willload",e.mod.getState(o),a,o,1))?(t=e.mod.getState(o),e.utils.unloaders[o]=e.utils.unloaders[o]||[],t.onunload&&e.utils.unloaders[o].push({controller:t,handler:t.onunload}),e.redraw(a,o,1),e.utils.callLCEvent("didload",e.mod.getState(o),a,o,1),d(o,a,n,e.utils.copyFun(r))):void 0};var o=function(t,n){return 0>n||n!=e.utils.items.getItem(t)?t==e.mod.getId(n)?!0:!1:!0},a=[];e.begin=function(e){n===a[e]?a[e]=1:a[e]++},e.end=function(t){if(1<a[t])a[t]--;else{a[t]=0;var n=e.utils.items.getItemVal(t);e.redraw(i(n),t)}},e.redraw=function(t,i,r){if(!a[i]){if(!t||n===i)throw Error("Mag.JS - Id or node invalid: "+i);o(t.id,i)&&(r&&e.fill.configs.splice(0,e.fill.configs.length),r&&e.mod.clear(i),t=f(t,i,r),fastdom.clear(e.mod.getFrameId(i)),t=fastdom.write(t),e.mod.setFrameId(i,t))}},e.hookin=function(e,t,n){r[e].push({context:{},handler:n,key:t})},e.hook=function(t,n,i){for(var o=0,a=r[t].length;a>o;o++)e.utils.callHook(r,n,t,o,i)};var u={},d=function(t,n,i,r){return i=function(t,n,i,r,o){return t=n.id+(r.key?"."+r.key:"")+"."+(o||0),o=u[t]||{},o.id=t,e.utils.items.isItem(t)||(u[t]=o=n.cloneNode(1),o.id=t),o instanceof HTMLElement?(t=e.utils.getItemInstanceId(o.id),e.mod.submodule(o.id,t,i,r),l(t,o.id),e.redraw(o,t,1),o):void 0}.bind({},t,n,i,r),i.getId=function(e){return e}.bind({},t),i.draw=function(t,n,i){e.redraw(t,n,i)}.bind({},n,t),i.getState=function(t){return e.mod.getState(t)}.bind({},t),i.getProps=function(t){return e.mod.getProps(t)}.bind({},t),i.toJSON=function(){return{id:this.getId(),props:this.getProps(),state:this.getState()}},i},c=[],l=function(t,n){var r=function(t,n){i(n)?e.redraw(i(n),t):e.utils.items.isItem(n)&&e.clear(t)}.bind({},t,n);e.props.setup(t,r)};e.clear=function(t){fastdom.clear(e.mod.getFrameId(t)),e.utils.items.removeItem(t),e.mod.clear(t),e.props.cached.splice(t,1),e.fill.clearCache(e.mod.getId(t))};var f=function(t,n,r){return function(t,n,r){if(i(t.id,1),o(t.id,n)&&t){var a=e.mod.getState(n);if(!e.utils.callLCEvent("isupdate",a,t,n)){var u=e.mod.getProps(n),u=e.utils.merge(e.utils.copy(u),e.utils.copy(a));if(e.mod.iscached(n,u)&&!r)return 0;if(r=!e.utils.callLCEvent("willupdate",a,t,n)){e.mod.callView(t,n),e.fill.setId(t.id),e.fill.run(t,a),r=t.id;var d,u=e.fill.configs;for(d in u)-1<d.indexOf('id("'+r+'")/')&&u[d]();d=t.id;for(var c in e.fill.cached)-1<c.indexOf('id("'+d+'")/')&&-1<c.indexOf("-config")&&e.fill.cached[c].configContext&&(e.utils.unloaders[n]=e.utils.unloaders[n]||[],e.utils.unloaders[n].push({controller:e.fill.cached[c].configContext,handler:e.fill.cached[c].configContext.onunload}));e.utils.callLCEvent("didupdate",a,t,n),r=t&&t.parentNode}r&&(t=s(t.parentNode))&&e.redraw(t,e.utils.items.getItem(t.id))}}}.bind({},t,n,r)},s=function(e){return e.id?e:e.parentNode?s(e.parentNode):n};e.getNode=i,window.mag=e}(window.mag||{},document),function(e){function t(t,n,i){var o=document.getElementById(i);return"undefined"!=typeof Proxy?new Proxy(new t,{get:function(t,n){if(void 0===t[n]&&!~r.indexOf(n.toString())){var i,a=e.fill.find(o,n),u="$"===n[0],d=[];return a.reverse().forEach(function(e,t){a[t]&&(a[t].value&&0<a[t].value.length?(i=a[t].value,!a[t].type||"checkbox"!=a[t].type&&"radio"!=a[t].type||(i={_value:i,_checked:a[t].checked},d.push(i))):a[t].innerText&&0<a[t].innerText.length?i=a[t].innerText:a[0].innerHTML&&0<a[t].innerHTML.length&&(i=a[t].innerHTML))}),0<d.length&&u?d:i}return t[n]}}):new t}var n=[],i={cache:[],getState:function(e){return n[e][1]},setState:function(e,t){n[e][1]=t},getView:function(e){return n[e][0]},getProps:function(e){return n[e][2]},setProps:function(e,t){return n[e][2]=t},remove:function(e){n.splice(e,1)},getId:function(e){return n[e]&&n[e][3]},exists:function(e){return void 0!==n[e]?!0:!1},setFrameId:function(e,t){n[e][4]=t},getFrameId:function(e){return n[e][4]},submodule:function(e,r,o,a){return n[r]?(i.setProps(r,a),n[r]):(n[r]=[0,0,0,0,0],i.setProps(r,a),a=function(e,t,n){o.view.call(o,t,i.getProps(e),n)}.bind({},r),n[r][0]=a,n[r][1]=t(function(){return(o.controller||function(){}).call(this,i.getProps(r))||this},r,e),n[r][3]=e,n[r])}},r="Symbol(Symbol.toStringTag) nodeType toJSON onunload onreload willupdate didupdate didload willload isupdate".split(" ");i.iscached=function(e,t){return i.cache[e]&&i.cache[e]===JSON.stringify(t)?!0:void(i.cache[e]=JSON.stringify(t))},i.clear=function(e){e>-1&&i.cache[e]&&i.cache.splice(e,1)};var o=[];i.callView=function(t,n){var r=i.getView(n);o[n]||(e.props.attachToArgs(n,i.getState(n),t),o[n]=1),r(i.getState(n),t)},e.mod=i}(window.mag||{}),function(e,t){function n(t,n){var i=[];return new Proxy(t,{deleteProperty:function(e,t){return n(),delete e[t]},set:function(t,r,o){return JSON.stringify(o)!==JSON.stringify(t[r])&&(i[r]=t[r]&&e.utils.copyFun(t[r],1)),n({type:"update",name:r,object:t,oldValue:i[r]}),t[r]=o,!0}})}function i(e,t){for(var i in e)Array.isArray(e[i])&&(e[i]=n(e[i],t));return n(e,t)}function r(e,n){return e&&t.Proxy?i(e,function(e){"object"==typeof e.object[e.name]&&(e.object[e.name]=r(e.object[e.name],n)),n(e)}):void 0}function o(e){for(var t in e)if(e[t]&&-1!==["INPUT","SELECT","TEXTAREA"].indexOf(e[t].tagName))return e[t];return!1}var a={},u=[];a.setup=function(t,n){if(!u[t]){var i=e.mod.getState(t),o=e.mod.getProps(t),i=r(i,function(t){"update"==t.type&&t.oldValue&&"function"==typeof t.oldValue.draw&&t.object[t.name]&&!t.object[t.name].draw&&(t=t.oldValue.getId(),e.utils.callLCEvent("onunload",e.mod.getState(t),e.getNode(e.mod.getId(t)),t),e.clear(t)),n()}),a=r(o,n),a=r(o,n);e.mod.setState(t,i),e.mod.setProps(t,a),u[t]=1}};var d=function(t,n){for(var i=1;i<t.length;i+=2){var r=t[i+1];n=e.fill.find(n,t[i]),n=n[r]}return n},c=function(t,n,i,r){return i=(""+i).split("."),3>i.length?(i=parseInt(i.pop()),i=isNaN(i)?0:i,n=e.fill.find(r[i]?r[i]:r,n)):(r=d(i,r),n=e.fill.find(r,n)),(n=o(n))&&!n.eventOnFocus&&(i=-1<["radio","checkbox"].indexOf(n.type),r=function(n,i){this.__magnum__=this.__magnum__||{},this.__magnum__.dirty||(this.__magnum__.dirty=1),i&&(t._checked=this.checked,e.redraw(n,e.utils.items.getItem(n.id),1))}.bind(n,r,i),i?n.addEventListener("click",r,!1):n.addEventListener("focus",r,!1),n.eventOnFocus=1),n},l=function(t,n,i,r){var a=i[n];"_value"===n&&(n=t.split(".").pop());var u=e.fill.find(r,n),u=o(u);if("function"!=typeof a&&u){var d=c.bind({},i,n,t,r);d(),Object.defineProperty(i,n,{configurable:!0,get:function(){var n=d();return n&&"undefined"!==n.value&&n.__magnum__&&n.__magnum__.dirty&&n.value!==a?(a=n.value,e.redraw(r,t,1),n.value):a},set:function(e){var t=d();t&&"undefined"!==t.value&&t.value!==e&&e!==a&&(t.value=e,a=e)}})}},f=function(e,t,n){for(var i in t){var r=t[i];"object"==typeof r?f(e+"."+i,r,n):l.bind({},e,i,t,n)()}};a.attachToArgs=f,a.cached=u,e.props=a}(window.mag||{},window),function(e){var t={callHook:function(e,t,n,i,r,o){r.change=!1,e[n][i].key==t&&(o=JSON.stringify({v:r.value,k:r.key}),e[n][i].handler.call(e[n][i].context,r),o!==JSON.stringify({v:r.value,k:r.key})&&(r.change=!0))},unloaders:[],callLCEvent:function(n,i,r,o,a){var u=!1,d={preventDefault:function(){u=!0}};if(i&&i[n]&&(i[n].call(i,d,r,e.mod.getProps(o)),a&&(i[n]=0)),u)for(i=0;n=t.unloaders[o][i];i++)n.controller.onunload&&(n.handler.call(n.controller,r),n.controller.onunload=0);return u},copy:function(e){return JSON.parse(JSON.stringify(e))},copyFun:function(n,i){if("object"!=typeof n)return n;if(Object.assign&&!i)return Object.assign(n);if(Object.create&&i)return Object.create(n);var r,o,a;r=Array.isArray(n)?[]:{};for(a in n)o=n[a],r[a]="object"==typeof o?t.copy(o):"function"==typeof o&&"fun"==o.type?e.prop(o()):o;return r},merge:function(e,n){for(var i in n)n[i]&&n[i].constructor==Object&&n.hasOwnProperty(i)&&("object"!=typeof e[i]&&(e[i]={}),e[i])?t.merge(e[i],n[i]):e[i]=n[i];return e}},n={i:[],isItem:function(e){return-1<n.i.indexOf(e)},setItem:function(e){n.i[n.i.length]=e},getItem:function(e){return n.i.indexOf(e)},getItemVal:function(e){return n.i[e]},removeItem:function(e){n.i.splice(n.i.indexOf(e),1)}};t.items=n,t.getItemInstanceIdAll=function(){return n.i},t.getItemInstanceId=function(e){return n.isItem(e)?n.getItem(e):(n.setItem(e),n.getItem(e))},e.utils=t}(window.mag||{}),function(e,t,n,i){function r(e){return Array.isArray&&Array.isArray(e)||"[object Array]"==={}.toString.call(e)}function o(e,t){return e[O]=e[O]||{},(!e[O].uid||t)&&(e[O].uid=performance.now()),e[O].uid}function a(e,t){var n=o(e,t);if(T[n])n=T[n];else{var i,r=T,a="";i=d(e);var u=e.parentNode&&[].indexOf.call(e.parentNode.children,e);i&&(a+='id("'+i.id+'")'),i=a+("/"+e.tagName+"["+(u+1)+"]"),n=r[n]=i}return n}function u(e,t,n){return e=o(e,n),A[N.id]=A[N.id]||[],A[N.id][e]&&A[N.id][e]==t?1:(A[N.id][e]=t,i)}function d(e){return e.id?e:e.parentNode?d(e.parentNode):i}function c(e){if(""!==e.id)return'id("'+e.id+'")';if(e===n.body)return e.tagName;var t=0;if(e.parentNode)for(var i=e.parentNode.childNodes,r=0;r<i.length;r++){var o=i[r];if(o===e)return c(e.parentNode)+"/"+e.tagName+"["+(t+1)+"]";1===o.nodeType&&o.tagName===e.tagName&&t++}}function l(e){var t=c(e);e.parentNode.removeChild(e),k[t+"-config"]&&k[t+"-config"].configContext&&typeof k[t+"-config"].configContext.onunload===C&&k[t+"-config"].configContext.onunload(k[t+"-config"].configContext,e,t)}function f(e){return(e=e&&parseInt(e.split("[").pop().slice(0,-1)))?parseInt(e)-1:0}function s(e){return e&&e[O]&&e[O].isChildOfArray?e:e.parentNode?s(e.parentNode):i}function h(e,t,i){if(!u(e,t.outerHTML,i)&&!n.getElementById(t.id)){for(;e.lastChild;)e.removeChild(e.lastChild);e.appendChild(t)}}function p(t,n,o){var a,u=f(o);if(n&&n.nodeType==_)return h(t,n),i;if("function"==typeof n){var d=(a=s(t.parentNode))&&a.getAttribute("key");return a&&d&&(u=+d.split(O)[1]),(n=n(u))&&n.nodeType&&n.nodeType==_?(h(t,n),t[O]=t[O]||{},t[O].isChildOfArray=!0,t[O].dataPass={index:u},i):(d=/<[a-z][\s\S]*>/i.test(n)?"_html":"_text",u={},u[d]=n,p(t,u,o))}if("object"!=typeof n)return p(t,{_text:n},o);for(d in n)u=n[d],u===i?u="":null===u&&-1===["onunload"].indexOf(d)?(t[O].detached=t[O].detached||[],t[O].detached[d]=1,g(t,d)):t[O].detached&&t[O].detached[d]&&(m(t,d),t[O].detached[d]=0),"_"===d[0]&&(a=a||{},a[d.substr(1)]=u);a&&w(t,a,o);for(d in n)if(u=n[d],-1===S.indexOf(d)&&"_"!==d[0]){a=x(t,d);var c={key:d,value:u,node:t};e.hook("values","*",c),c.change&&(u=c.value),r(u)&&(a=x(t,"$"+d)),N.run(a,u,o+"/"+d)}}function m(e,t){x(e,t).forEach(function(e){var t=o(e);if(j[t]){for(var n in j[t])e.appendChild(j[t][n]);delete j[t]}})}function g(e,t){x(e,t).forEach(function(e){var t=o(e);for(e.children.length&&(j[t]=v(e.children));e.lastChild;)l(e.lastChild)})}function v(e){var t;if(null==e.length&&(e=[e]),!r(e)){t=[];for(var n=0;n<e.length;n+=1)e[n]&&t.push(e[n]);e=t}return e}function y(t,i,r){return function(t,i,r){var o=s(i),u=o&&c(o),d=f(u),l=a(i),h=f(l),o={path:u,data:((o||{})[O]||[]).dataPass,node:o,index:d},l=l&&-1<l.indexOf("id(")&&l.split('id("')[1].split('")')[0],u=n.getElementById(l);return t=t.call(i,r,h,i,o),e.redraw(u,e.utils.items.getItem(l),1),t}.bind({},i[r],t)}function w(n,i,r){var o,a=f(r);for(o in i)if("text"!==o&&"html"!==o)if(0==o.indexOf("on"))n[o.toLowerCase()]=y(n,i,o);else if("config"==o){r=c(n);var a=f(r),u=!0;k[r+"-config"]?u=!1:k[r+"-config"]={};var d=k[r+"-config"].configContext=k[r+"-config"].configContext||{};t[r]=function(e,t){return function(){return e.apply(e,t)}}(i[o],[n,u,d,a])}else r={key:o,value:i[o],node:n},e.hook("attributes",o,r),r.change&&(o=r.key,i[o]=r.value),null===i[o]?n.removeAttribute(o):(o in n&&(n[o]=i[o]),n.setAttribute(o,""+i[o]));b(n,i.text),I(n,i.html)}function b(e,t){var n,i;if(e&&null!=t&&!u(e,t)){if(!i){i=[];for(var r=0;r<e.childNodes.length;r+=1)n=e.childNodes[r],n.nodeType===_&&i.push(n)}for(;e.lastChild;)e.removeChild(e.lastChild);for("INPUT"===e.nodeName?e.value=""+t:e.appendChild(e.ownerDocument.createTextNode(""+t)),r=0;r<i.length;r+=1)e.appendChild(i[r]);"SELECT"===e.nodeName&&(e.value=""+t)}}function I(e,t){e&&null!=t&&!u(e,t)&&(e.innerHTML=t)}function x(t,n,i){var r=[];if(t){var o=t.childNodes;if(o)for(var a=0;a<o.length;a+=1)o[a].nodeType===_&&r.push(o[a])}var o=[],a=n,u="$"===n[0];"$"===a[0]&&(a=a.substr(1));for(var d=0;d<r.length;d+=1){var c=r[d],l=a,f=" "+c.className+" ";(c.id===l||-1<f.indexOf(" "+l+" ")||c.name===l||c.nodeName.toLowerCase()===l.toLowerCase()||c.getAttribute("data-bind")===l)&&o.push(r[d])}if(!o.length||u)for(d=0;d<r.length&&(o=o.concat(x(r[d],n,!0)),!o.length||u);d++);return i||o.length||(t={key:n,value:o,node:t},e.hook("elementMatcher",n,t),t.change&&(o=t.value)),o}var N={},_=1,k=[],O="__magnum__",C="function",S="onunload onreload willupdate didupdate didload willload isupdate".split(" "),T=[],A=[],E={};N.run=function(e,t,n){var o,u,d;if(e){null==t&&(t={_text:""});var c=v(e);if(d=r(t)){if(E[n]&&0===c.length&&(E[n].parent.insertAdjacentHTML("beforeend",E[n].node),c=v(E[n].parent.children)),0===c.length)return;for(u=c[0].parentNode,E[n]||(E[n]={node:c[0].cloneNode(!0).outerHTML,parent:u});c.length<t.length;)E[n]?(u.insertAdjacentHTML("beforeend",E[n].node),o=u.lastChild):o=c[0].cloneNode(!0),c.push(o),u&&u.appendChild(o);if(c.map(function(e){return e.__key}),n=t.map(function(e){return e._key}),(c.length==t.length||-1!==n.indexOf(i))&&(t=t.map(function(e,t){if("object"==typeof e){if(c[t].__key&&void 0===e._key)return e._key=c[t].__key,e;void 0===e._key&&(e._key=O+t),c[t].__key=e._key}return e})),c.length>t.length)if(0===t.length||"object"!=typeof t[0])for(;c.length>t.length;)o=c.pop(),(u=o.parentNode)&&l(o);else var f=[],s=t.map(function(e){return e._key}),c=(c.map(function(e){return e.__key}),c.filter(function(e){return-1===s.indexOf(e.__key)||-1!==f.indexOf(e.__key)?(f.push(e.__key),l(e),!1):(f.push(e.__key),!0)}))}for(n=0;n<c.length;n++)d?c[n]&&N.run(c[n],t[n]):(t&&"object"==typeof t&&-1!==Object.keys(t).indexOf("_key")&&(c[n][O]=c[n][O]||{},c[n][O].isChildOfArray=!0,c[n][O].dataPass=t),o=a(c[n]),p(c[n],t,o));return e}};var j=[];N.configs=t,N.find=x,N.setId=function(e){N.id=e},N.clearCache=function(e){A[e]&&delete A[e]},e.fill=N}(window.mag||{},[],document),function(e){function t(){this.frames=[],this.lastId=0,this.raf=n,this.batch={hash:{},read:[],write:[],mode:null}}var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)};t.prototype.write=function(e,t){var n=this.add("write",e,t),i=this.batch.mode,r=n.id;return this.batch.write.push(n.id),"writing"===i||"reading"===i||this.batch.scheduled?r:(this.scheduleBatch(),r)},t.prototype.clear=function(e){if("function"==typeof e)return this.clearFrame(e);e=+e;var t=this.batch.hash[e];if(t){var t=this.batch[t.type],n=t.indexOf(e);delete this.batch.hash[e],~n&&t.splice(n,1)}},t.prototype.clearFrame=function(e){e=this.frames.indexOf(e),~e&&this.frames.splice(e,1)},t.prototype.scheduleBatch=function(){var e=this;this.schedule(0,function(){e.batch.scheduled=!1,e.runBatch()}),this.batch.scheduled=!0},t.prototype.uniqueId=function(){return++this.lastId},t.prototype.flush=function(e){for(var t;t=e.shift();)this.run(this.batch.hash[t])},t.prototype.runBatch=function(){this.batch.mode="reading",this.flush(this.batch.read),this.batch.mode="writing",this.flush(this.batch.write),this.batch.mode=null},t.prototype.add=function(e,t,n){var i=this.uniqueId();return this.batch.hash[i]={id:i,fn:t,ctx:n,type:e}},t.prototype.run=function(e){var t=e.ctx||this,n=e.fn;return delete this.batch.hash[e.id],this.onError?void n.call(t):n.call(t)},t.prototype.loop=function(){var e=this,t=this.raf;this.looping||(t(function n(){var i=e.frames.shift();e.frames.length?t(n):e.looping=!1,i&&i()}),this.looping=!0)},t.prototype.schedule=function(e,t){return this.frames[e]?this.schedule(e+1,t):(this.loop(),this.frames[e]=t)},e=e||new t,window.fastdom=e}(window.fastdom);
