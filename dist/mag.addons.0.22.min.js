/*
Mag.JS AddOns v0.23.7
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
(function(a,b,c,d){'use strict';function f(r,s){for(var y,t=Object.keys(r),u=0,w=t.length;u<w;++u)y=t[u],s(y,r[y])}function g(r){return r.replace(/([a-z])([A-Z])/g,'$1-$2').toLowerCase()}var h=0,m=r=>s=>()=>{return s=s||{},s.key=s.key||++h,r(s)};a.create=function(r,s,t){if('function'==typeof s){var u=a(r,s,t);return m(u)}return'function'==typeof r?m(r):w=>a.module(r,s,a.merge(a.copy(t)||{},a.copy(w)||{}))},a.template=function(r,s){var t=r;return'prod'==a.ENV&&(t={url:r,cache:1}),a.request(t).then(function(u){var w=a.html2dom(u);return s&&s(w),w})},a.html2dom=function(r){var s=a.doc.createElement('template');return s.innerHTML=r,s.content.children[0]},a.getTags=function(r){var s=a.utils.items.getItemVal(a.mod.runningViewInstance),t=a.getNode(s),u=(t||a.doc).getElementsByTagName(r),w=[].slice.call(u);return w},a.tag=function(r,s,t,u){var w=a.getTags(r),y=[];if(u=u||'module',w.length)for(var z of w)y.push(a[u](z,s,t));return 1==y.length?y[0]:y},a.noop=function(){},a.copy=a.utils.copy,a.merge=a.utils.merge,a.isEmpty=function(r){if(!r||0==r.length)return!0;if('Object]'==r.toString().substr(-7)){for(var s in r)if(r.hasOwnProperty(s))return!1;return!0}return r.trim()},a.show=function(r,s){var t=typeof r;if('object'!=t){var u={_config:function(w){w.style.display=r?'block':'none'}};return'object'==typeof s&&a.merge(s,u),u}'object'==t?r.willload=function(w){w.style.display='block'}:r.willupdate=function(w,y){w.style.display=y[s]?'block':'none'}},a.deferred=function(){var r={};return r.promise=new Promise(function(s,t){r.resolve=s,r.reject=t}),r},a.when=function(r,s){return Promise.all(r).then(s)},a.request=function(r){if('string'==typeof r){var s=r;r={},r.url=s}var t=a.deferred();r.initialValue&&(t.promise.initialValue=r.initialValue);var u=JSON.stringify(r);if(r.cache){var w=a.cache(u);if(w)return t.resolve(w),t.promise}if(a.request.queue[u])return a.request.queue[u];a.request.queue[u]=t.promise;var y=new XMLHttpRequest,z=(r.method||'GET').toUpperCase(),A='GET'!==z&&r.data?'object'==typeof r.data?JSON.stringify(r.data):r.data:'';if(y.onload=function(E){var F=y.getResponseHeader('content-type')||'',G=E.target.responseText;-1<F.indexOf('json')&&(G=JSON.parse(G)),r.cache&&a.cache(u,G,r.cacheTime,r.cacheType),delete a.request.queue[u];var H=y.getAllResponseHeaders();t.resolve(G,H)},y.onerror=function(E){t.reject(E)},y.open(z,r.url),r.withCredentials&&(y.withCredentials=r.withCredentials),r.headers)for(var C,B=0;B<r.headers.length;B++)for(var D in C=r.headers[B],C)y.setRequestHeader(D,C[D]);return y.send(A),t.promise.abort=()=>y.abort(),t.promise},a.request.queue={},a.cache=function(r,s,t,u){var w=b[u||'sessionStorage'];if(1==arguments.length){if(a.cache.data[r])return a.cache.data[r].data;var y=w.getItem(r);return y?(a.cache.data[r]=JSON.parse(y),a.cache.data[r].data):0}a.cache.data[r]&&a.cache.data[r].id&&clearTimeout(a.cache.data[r].id);var z=setTimeout(function(A){w.removeItem(A),delete a.cache.data[A]}.bind({},r),t||600000);a.cache.data[r]={id:z,data:s},w.setItem(r,JSON.stringify(a.cache.data[r]))},a.cache.data={},a.requestWithFeedback=function(r){var s=JSON.stringify(r);if(!a.requestWithFeedback.cache[s]){for(var w,t=c.querySelectorAll('.loader'),u=0;w=t[u];u++)w.style.display='block';var y=function(z){if(delete a.requestWithFeedback.cache[s],0==Object.keys(a.requestWithFeedback.cache).length)for(var B,A=0;B=t[A];A++)B.style.display='none';return z};a.requestWithFeedback.cache[s]=a.request(r),a.requestWithFeedback.cache[s].then(y,function(z){throw y(z),z})}return a.requestWithFeedback.cache[s]},a.requestWithFeedback.cache={},a.disable=function(r,s){var t=s&&s._config?s._config:function(){},u={_config:function(w){t.apply(this,arguments),r()?w.setAttribute('disabled','disabled'):w.removeAttribute('disabled')}};return s&&a.merge(s,u),u},a.find=function(r,s){var t=c.getElementById(r);return a.fill.find(t,s)},a.toMenu=function(r,s){return r.map(function(t,u){return{_text:t,_value:u,_selected:s===u||s===t||null}})},a.namespace=function(r,s){var t=r.split('.'),u=t.shift();return s=s||this,s[u]=s[u]||{},t.length?a.namespace(t.join('.'),s[u]):s[u]},a.route=function(r){'use strict';function u(){for(var C,y=r.location.hash.substr(1),z=y.split('/'),A=z.length,B=0;B<w.length;B++)if(C=w[B],C.parts.length===A){for(var D=[],E=0;E<A;E++)if(':'===C.parts[E].substr(0,1))D.push(z[E]);else if(C.parts[E]!==z[E])break;if(E===A)return void C.handler.apply(d,D)}}var w=[];return r.onhashchange=u,{addRoute:function(y,z){w.push({parts:y.split('/'),handler:z})},load:function(y){r.location.hash=y},start:u}}(b),a.hookin('attributes','key',function(r){r.value=null});var o={opacity:1,zIndex:1,float:1,fontWeight:1,gridColumn:1,lineHeight:1,transform:1,zoom:1};a.hookin('attributes','style',function(r){if('object'==typeof r.value){var s='';f(r.value,function(t,u){null!=u&&(s+=g(t)+':'+(isNaN(u)||t in o?u:u+'px')+';')}),r.value=s}}),a.hookin('attributes','className',function(r){r.key='class';var s=r.value,t=r.node.classList+'';if('string'==typeof r.value)s=r.value.split(' ');else if('object'==typeof r.value){for(var u in s)r.node.classList.toggle(u,'undefined'!=typeof s[u]&&s[u]);return void(r.value=r.node.classList+'')}for(var u in r.value=r.node.classList+'',s){var w=s[u];w.trim()&&0<r.node.classList.length&&!r.node.classList.contains(w.trim())?r.value=r.node.classList+' '+w:w.trim()&&0==r.node.classList.length&&(r.value+=w+' ')}r.value.trim()!==t&&(r.change=1),r.value=r.value.trim()});var q=[];a.hookin('values','*',function(r){var s=typeof r.value;null==r.value||('function'==s&&r.value.toJSON?(r.change=1,r.value=r.value()):'object'==s&&'function'==typeof r.value.then&&(!q[a.fill.id+r.key]&&(q[a.fill.id+r.key]=1,r.value.then(function(t,u,w){if(t){var y=a.utils.items.getItem(t);~y&&(a.mod.getState(y)[u]=w,a.redraw(a.getNode(t),y),q[t+r.key]=0)}return w}.bind(null,a.fill.id,r.key))),r.value.initialValue&&(r.change=1,r.value=r.value.initialValue)))}),a.getId=function(r){return a.utils.items.getItemVal(r)},a.prop=function(r){var s=function(){return arguments.length&&(r=arguments[0]),r};return s.toJSON=function(){return r},s},a.withProp=function(r,s){return function(t){t=t||event;var u=t.currentTarget||this;s(r in u?u[r]:u.getAttribute(r))}}})(mag,window||global||this,document);
