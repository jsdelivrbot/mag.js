/*
Mag.JS AddOns v0.22.2
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,t,n,i){function r(e,t){for(var n=Object.keys(e),i=0,r=n.length;r>i;++i){var a=n[i];t(a,e[a])}}e.noop=function(){},e.copy=e.utils.copy,e.merge=e.utils.merge,e.show=function(t,n){var i=typeof t;return"object"!==i?(i={_config:function(e){e.style.display=t?"block":"none"}},"object"==typeof n&&e.merge(n,i),i):void("object"==i?t.willload=function(e,t){t.style.display="block"}:t.willupdate=function(e,t,i){t.style.display=i[n]?"block":"none"})},e.deferred=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},e.when=function(e,t){return Promise.all(e).then(t)},e.request=function(t){var n=e.deferred();t.initialValue&&(n.promise.initialValue=t.initialValue);var i=JSON.stringify(t);if(t.cache){var r=e.cache(i);if(r)return n.resolve(r),n.promise}if(e.request.queue[i])return e.request.queue[i];e.request.queue[i]=n.promise;var a=new XMLHttpRequest,o=(t.method||"GET").toUpperCase(),r="GET"!==o&&t.data?t.data:"";if(a.onload=function(r){var o=a.getResponseHeader("content-type")||"";r=r.target.responseText,-1<o.indexOf("json")&&(r=JSON.parse(r)),t.cache&&e.cache(i,r,t.cacheTime,t.cacheType),delete e.request.queue[i],o=a.getAllResponseHeaders(),n.resolve(r,o)},a.onerror=function(e){n.reject(e)},a.open(o,t.url),t.headers)for(o=0;o<t.headers.length;o++){var u,l=t.headers[o];for(u in l)a.setRequestHeader(u,l[u])}return a.send(r),n.promise},e.request.queue={},e.cache=function(n,i,r,a){var o=t[a||"sessionStorage"];if(1==arguments.length){if(e.cache.data[n])return e.cache.data[n].data;var u=o.getItem(n);return u?(e.cache.data[n]=JSON.parse(u),e.cache.data[n].data):0}e.cache.data[n]&&e.cache.data[n].id&&clearTimeout(e.cache.data[n].id),u=setTimeout(function(t){o.removeItem(t),delete e.cache.data[t]}.bind({},n),r||6e5),e.cache.data[n]={id:u,data:i},o.setItem(n,JSON.stringify(e.cache.data[n]))},e.cache.data={},e.requestWithFeedback=function(t){var i=JSON.stringify(t);if(!e.requestWithFeedback.cache[i]){for(var r,a=n.querySelectorAll(".loader"),o=0;r=a[o];o++)r.style.display="block";var u=function(t){if(delete e.requestWithFeedback.cache[i],0==Object.keys(e.requestWithFeedback.cache).length)for(var n,r=0;n=a[r];r++)n.style.display="none";return t};e.requestWithFeedback.cache[i]=e.request(t),e.requestWithFeedback.cache[i].then(u,function(e){throw u(e),e})}return e.requestWithFeedback.cache[i]},e.requestWithFeedback.cache={},e.disable=function(t,n){var i=n&&n._config?n._config:function(){},r={_config:function(e){i.apply(this,arguments),t()?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled")}};return n&&e.merge(n,r),r},e.find=function(t,i){var r=n.getElementById(t);return e.fill.find(r,i)},e.toMenu=function(e,t){return e.map(function(e,n){return{_text:e,_value:n,_selected:t===n||t===e?!0:null}})},e.namespace=function(t,n){var i=t.split("."),r=i.shift();return n=n||this,n[r]=n[r]||{},i.length?e.namespace(i.join("."),n[r]):n[r]},e.route=function(e){function t(){for(var t=e.location.hash.substr(1).split("/"),r=t.length,a=0;a<n.length;a++){var o=n[a];if(o.parts.length===r){for(var u=[],l=0;r>l;l++)if(":"===o.parts[l].substr(0,1))u.push(t[l]);else if(o.parts[l]!==t[l])break;if(l===r)return o.handler.apply(i,u),i}}}var n=[];return e.onhashchange=t,{addRoute:function(e,t){n.push({parts:e.split("/"),handler:t})},load:function(t){e.location.hash=t},start:t}}(t),e.hookin("attributes","key",function(e){e.value=null}),e.hookin("attributes","style",function(e){if("object"==typeof e.value){var t=e.node.getAttribute("style")||"",n="";r(e.value,function(e,t){n+=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+":"+(isNaN(t)?t:t+"px")+";"}),e.value=t&&~t.indexOf(n)?t:t+n}}),e.hookin("attributes","className",function(e){e.key="class";var t=e.value,n=e.node.classList+"";if("string"==typeof e.value)t=e.value.split(" ");else if("object"==typeof e.value){for(var r in t)e.node.classList.toggle(r,t[r]);return e.value=e.node.classList+"",i}e.value=e.node.classList+"";for(r in t){var a=t[r];a.trim()&&0<e.node.classList.length&&!e.node.classList.contains(a.trim())?e.value=e.node.classList+" "+a:a.trim()&&0==e.node.classList.length&&(e.value+=a+" ")}e.value.trim()!==n&&(e.change=1),e.value=e.value.trim()}),e.hookin("values","*",function(t){var n=typeof t.value;if(null!=t.value)if("function"===n&&t.value.toJSON)t.change=1,t.value=t.value();else if("object"==n&&"function"==typeof t.value.then){var i=e.utils.items.getItem(e.fill.id);t.value.then(function(n){e.mod.getState(i)[t.key]=n}),t.value.initialValue&&(t.change=1,t.value=t.value.initialValue)}}),e.getId=function(t){return e.utils.items.getItemVal(t)},e.prop=function(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t},e.withProp=function(e,t){return function(n){n=n||event,n=n.currentTarget||this,t(e in n?n[e]:n.getAttribute(e))}}}(mag,window||global||this,document);
