/*
Mag.JS AddOns v0.22.4
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,t,a,n){"use strict";function r(e,t){for(var a=Object.keys(e),n=0,r=a.length;r>n;++n){var i=a[n];t(i,e[i])}}function i(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}e.noop=function(){},e.copy=e.utils.copy,e.merge=e.utils.merge,e.isEmpty=function(e){return 0===Object.keys(e).length},e.show=function(t,a){var n=typeof t;if("object"!==n){var r={_config:function(e){e.style.display=t?"block":"none"}};return"object"==typeof a&&e.merge(a,r),r}"object"==n?t.willload=function(e,t){t.style.display="block"}:t.willupdate=function(e,t,n){t.style.display=n[a]?"block":"none"}},e.deferred=function(){var e={};return e.promise=new Promise(function(t,a){e.resolve=t,e.reject=a}),e},e.when=function(e,t){return Promise.all(e).then(t)},e.request=function(t){var a=e.deferred();t.initialValue&&(a.promise.initialValue=t.initialValue);var n=JSON.stringify(t);if(t.cache){var r=e.cache(n);if(r)return a.resolve(r),a.promise}if(e.request.queue[n])return e.request.queue[n];e.request.queue[n]=a.promise;var i=new XMLHttpRequest,u=(t.method||"GET").toUpperCase(),o="GET"!==u&&t.data?t.data:"";if(i.onload=function(r){var u=i.getResponseHeader("content-type")||"",o=r.target.responseText;u.indexOf("json")>-1&&(o=JSON.parse(o)),t.cache&&e.cache(n,o,t.cacheTime,t.cacheType),delete e.request.queue[n];var s=i.getAllResponseHeaders();a.resolve(o,s)},i.onerror=function(e){a.reject(e)},i.open(u,t.url),t.headers)for(var s=0;s<t.headers.length;s++){var c=t.headers[s];for(var l in c)i.setRequestHeader(l,c[l])}return i.send(o),a.promise},e.request.queue={},e.cache=function(a,n,r,i){var u=t[i||"sessionStorage"];if(1==arguments.length){if(e.cache.data[a])return e.cache.data[a].data;var o=u.getItem(a);return o?(e.cache.data[a]=JSON.parse(o),e.cache.data[a].data):0}e.cache.data[a]&&e.cache.data[a].id&&clearTimeout(e.cache.data[a].id);var s=setTimeout(function(t){u.removeItem(t),delete e.cache.data[t]}.bind({},a),r||6e5);e.cache.data[a]={id:s,data:n},u.setItem(a,JSON.stringify(e.cache.data[a]))},e.cache.data={},e.requestWithFeedback=function(t){var n=JSON.stringify(t);if(!e.requestWithFeedback.cache[n]){for(var r,i=a.querySelectorAll(".loader"),u=0;r=i[u];u++)r.style.display="block";var o=function(t){if(delete e.requestWithFeedback.cache[n],0==Object.keys(e.requestWithFeedback.cache).length)for(var a,r=0;a=i[r];r++)a.style.display="none";return t};e.requestWithFeedback.cache[n]=e.request(t),e.requestWithFeedback.cache[n].then(o,function(e){throw o(e),e})}return e.requestWithFeedback.cache[n]},e.requestWithFeedback.cache={},e.disable=function(t,a){var n=a&&a._config?a._config:function(){},r={_config:function(e){n.apply(this,arguments),t()?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled")}};return a&&e.merge(a,r),r},e.find=function(t,n){var r=a.getElementById(t);return e.fill.find(r,n)},e.toMenu=function(e,t){return e.map(function(e,a){return{_text:e,_value:a,_selected:t===a||t===e?!0:null}})},e.namespace=function(t,a){var n=t.split("."),r=n.shift();return a=a||this,a[r]=a[r]||{},n.length?e.namespace(n.join("."),a[r]):a[r]},e.route=function(e){function t(e,t){i.push({parts:e.split("/"),handler:t})}function a(t){e.location.hash=t}function r(){for(var t=e.location.hash.substr(1),a=t.split("/"),r=a.length,u=0;u<i.length;u++){var o=i[u];if(o.parts.length===r){for(var s=[],c=0;r>c;c++)if(":"===o.parts[c].substr(0,1))s.push(a[c]);else if(o.parts[c]!==a[c])break;if(c===r)return o.handler.apply(n,s),n}}}var i=[];return e.onhashchange=r,{addRoute:t,load:a,start:r}}(t),e.hookin("attributes","key",function(e){e.value=null}),e.hookin("attributes","style",function(e){if("object"==typeof e.value){var t=e.node.getAttribute("style")||"",a="";r(e.value,function(e,t){a+=i(e)+":"+(isNaN(t)?t:t+"px")+";"}),e.value=t&&~t.indexOf(a)?t:t+a}}),e.hookin("attributes","className",function(e){e.key="class";var t=e.value,a=e.node.classList+"";if("string"==typeof e.value)t=e.value.split(" ");else if("object"==typeof e.value){for(var r in t)e.node.classList.toggle(r,t[r]);return e.value=e.node.classList+"",n}e.value=e.node.classList+"";for(var r in t){var i=t[r];i.trim()&&e.node.classList.length>0&&!e.node.classList.contains(i.trim())?e.value=e.node.classList+" "+i:i.trim()&&0==e.node.classList.length&&(e.value+=i+" ")}e.value.trim()!==a&&(e.change=1),e.value=e.value.trim()}),e.hookin("values","*",function(t){var a=typeof t.value;if(null==t.value);else if("function"===a&&t.value.toJSON)t.change=1,t.value=t.value();else if("object"==a&&"function"==typeof t.value.then){var n=e.utils.items.getItem(e.fill.id);t.value.then(function(a){e.mod.getState(n)[t.key]=a,e.redraw(e.getNode(e.fill.id),n,1)}),t.value.initialValue&&(t.change=1,t.value=t.value.initialValue)}}),e.getId=function(t){return e.utils.items.getItemVal(t)},e.prop=function(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t},e.withProp=function(e,t){return function(a){a=a||event;var n=a.currentTarget||this;t(e in n?n[e]:n.getAttribute(e))}}}(mag,window||global||this,document);
