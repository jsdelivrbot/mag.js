/*
Mag.JS AddOns v0.23.6
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
(function(a,b,c,d){'use strict';function f(o,p){for(var t,q=Object.keys(o),r=0,s=q.length;r<s;++r)t=q[r],p(t,o[t])}function g(o){return o.replace(/([a-z])([A-Z])/g,'$1-$2').toLowerCase()}a.create=function(o,p,q){var r=a(o,p,q);return s=>t=>{return(!s||s&&!s.key&&t)&&(s=s||{},s.key=t),r(s)}},a.template=function(o,p){var q=o;return'prod'==a.ENV&&(q={url:o,cache:1}),a.request(q).then(function(r){var s=a.html2dom(r);return p&&p(s),s})},a.html2dom=function(o){var p=a.doc.createElement('template');return p.innerHTML=o,p.content.children[0]},a.getTags=function(o){var p=a.utils.items.getItemVal(a.mod.runningViewInstance),q=a.getNode(p),r=(q||a.doc).getElementsByTagName(o),s=[].slice.call(r);return s},a.tag=function(o,p,q,r){var s=a.getTags(o),t=[];if(r=r||'module',s.length)for(var u of s)t.push(a[r](u,p,q));return 1==t.length?t[0]:t},a.noop=function(){},a.copy=a.utils.copy,a.merge=a.utils.merge,a.isEmpty=function(o){if(!o||0==o.length)return!0;if('Object]'==o.toString().substr(-7)){for(var p in o)if(o.hasOwnProperty(p))return!1;return!0}return o.trim()},a.show=function(o,p){var q=typeof o;if('object'!=q){var r={_config:function(s){s.style.display=o?'block':'none'}};return'object'==typeof p&&a.merge(p,r),r}'object'==q?o.willload=function(s){s.style.display='block'}:o.willupdate=function(s,t){s.style.display=t[p]?'block':'none'}},a.deferred=function(){var o={};return o.promise=new Promise(function(p,q){o.resolve=p,o.reject=q}),o},a.when=function(o,p){return Promise.all(o).then(p)},a.request=function(o){if('string'==typeof o){var p=o;o={},o.url=p}var q=a.deferred();o.initialValue&&(q.promise.initialValue=o.initialValue);var r=JSON.stringify(o);if(o.cache){var s=a.cache(r);if(s)return q.resolve(s),q.promise}if(a.request.queue[r])return a.request.queue[r];a.request.queue[r]=q.promise;var t=new XMLHttpRequest,u=(o.method||'GET').toUpperCase(),w='GET'!==u&&o.data?'object'==typeof o.data?JSON.stringify(o.data):o.data:'';if(t.onload=function(B){var C=t.getResponseHeader('content-type')||'',D=B.target.responseText;-1<C.indexOf('json')&&(D=JSON.parse(D)),o.cache&&a.cache(r,D,o.cacheTime,o.cacheType),delete a.request.queue[r];var E=t.getAllResponseHeaders();q.resolve(D,E)},t.onerror=function(B){q.reject(B)},t.open(u,o.url),o.withCredentials&&(t.withCredentials=o.withCredentials),o.headers)for(var z,y=0;y<o.headers.length;y++)for(var A in z=o.headers[y],z)t.setRequestHeader(A,z[A]);return t.send(w),q.promise},a.request.queue={},a.cache=function(o,p,q,r){var s=b[r||'sessionStorage'];if(1==arguments.length){if(a.cache.data[o])return a.cache.data[o].data;var t=s.getItem(o);return t?(a.cache.data[o]=JSON.parse(t),a.cache.data[o].data):0}a.cache.data[o]&&a.cache.data[o].id&&clearTimeout(a.cache.data[o].id);var u=setTimeout(function(w){s.removeItem(w),delete a.cache.data[w]}.bind({},o),q||600000);a.cache.data[o]={id:u,data:p},s.setItem(o,JSON.stringify(a.cache.data[o]))},a.cache.data={},a.requestWithFeedback=function(o){var p=JSON.stringify(o);if(!a.requestWithFeedback.cache[p]){for(var s,q=c.querySelectorAll('.loader'),r=0;s=q[r];r++)s.style.display='block';var t=function(u){if(delete a.requestWithFeedback.cache[p],0==Object.keys(a.requestWithFeedback.cache).length)for(var y,w=0;y=q[w];w++)y.style.display='none';return u};a.requestWithFeedback.cache[p]=a.request(o),a.requestWithFeedback.cache[p].then(t,function(u){throw t(u),u})}return a.requestWithFeedback.cache[p]},a.requestWithFeedback.cache={},a.disable=function(o,p){var q=p&&p._config?p._config:function(){},r={_config:function(s){q.apply(this,arguments),o()?s.setAttribute('disabled','disabled'):s.removeAttribute('disabled')}};return p&&a.merge(p,r),r},a.find=function(o,p){var q=c.getElementById(o);return a.fill.find(q,p)},a.toMenu=function(o,p){return o.map(function(q,r){return{_text:q,_value:r,_selected:p===r||p===q||null}})},a.namespace=function(o,p){var q=o.split('.'),r=q.shift();return p=p||this,p[r]=p[r]||{},q.length?a.namespace(q.join('.'),p[r]):p[r]},a.route=function(o){'use strict';function r(){for(var z,t=o.location.hash.substr(1),u=t.split('/'),w=u.length,y=0;y<s.length;y++)if(z=s[y],z.parts.length===w){for(var A=[],B=0;B<w;B++)if(':'===z.parts[B].substr(0,1))A.push(u[B]);else if(z.parts[B]!==u[B])break;if(B===w)return void z.handler.apply(d,A)}}var s=[];return o.onhashchange=r,{addRoute:function(t,u){s.push({parts:t.split('/'),handler:u})},load:function(t){o.location.hash=t},start:r}}(b),a.hookin('attributes','key',function(o){o.value=null});var h={opacity:1,zIndex:1,float:1,fontWeight:1,gridColumn:1,lineHeight:1,transform:1,zoom:1};a.hookin('attributes','style',function(o){if('object'==typeof o.value){var p=o.node.getAttribute('style')||'',q='';f(o.value,function(r,s){q+=g(r)+':'+(isNaN(s)||r in h?s:s+'px')+';'}),o.value=p&&~p.indexOf(q)?p:p+q}}),a.hookin('attributes','className',function(o){o.key='class';var p=o.value,q=o.node.classList+'';if('string'==typeof o.value)p=o.value.split(' ');else if('object'==typeof o.value){for(var r in p)o.node.classList.toggle(r,'undefined'!=typeof p[r]&&p[r]);return void(o.value=o.node.classList+'')}for(var r in o.value=o.node.classList+'',p){var s=p[r];s.trim()&&0<o.node.classList.length&&!o.node.classList.contains(s.trim())?o.value=o.node.classList+' '+s:s.trim()&&0==o.node.classList.length&&(o.value+=s+' ')}o.value.trim()!==q&&(o.change=1),o.value=o.value.trim()});var m=[];a.hookin('values','*',function(o){var p=typeof o.value;null==o.value||('function'==p&&o.value.toJSON?(o.change=1,o.value=o.value()):'object'==p&&'function'==typeof o.value.then&&(!m[a.fill.id+o.key]&&(m[a.fill.id+o.key]=1,o.value.then(function(q,r,s){if(q){var t=a.utils.items.getItem(q);~t&&(a.mod.getState(t)[r]=s,a.redraw(a.getNode(q),t),m[q+o.key]=0)}return s}.bind(null,a.fill.id,o.key))),o.value.initialValue&&(o.change=1,o.value=o.value.initialValue)))}),a.getId=function(o){return a.utils.items.getItemVal(o)},a.prop=function(o){var p=function(){return arguments.length&&(o=arguments[0]),o};return p.toJSON=function(){return o},p},a.withProp=function(o,p){return function(q){q=q||event;var r=q.currentTarget||this;p(o in r?r[o]:r.getAttribute(o))}}})(mag,window||global||this,document);
