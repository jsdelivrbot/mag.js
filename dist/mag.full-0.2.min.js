//////////////////////////////////
//MagJS
//////////////////////////////////
/**!
 * @name mag.js - Copyright (c) 2013, 2014 Michael Glazer
 * @description MagnumJS core code library
 * @author Michael Glazer
 * @date 8/18/13, 4/11/14
 * @plunker - http://embed.plnkr.co/ZqpuhSsnMPcCNz9vufay/preview
 * @version 0.1 - Alpha - 0.2
 * @license MIT https://github.com/magnumjs/mag.js/blob/master/LICENSE
 * @link https://github.com/magnumjs
 */
;"use strict";!function(a,b){var c="warn",d=function(){var a=[].shift.apply(arguments),b=Array.prototype.slice.call(arguments);a==c&&console&&console[c](b.join(","))};a.aspect={injectors:[],namespace:null,add:function(b,c,d){a.aspect.injectors.push({type:b,name:c,fun:d})},attach:function(){for(var b in a.aspect.injectors){var c=a.aspect.injectors[b];a.aspect[c.type]&&a.aspect[c.type](c.name,c.fun)}},around:function(b,c){var d=a.aspect.namespace;for(var e in a.aspect.namespace)"function"==typeof d[e]&&e.match(b)&&function(a,b,d){d[b]=function(){return c.call(d,{fn:a,fnName:b,arguments:arguments})}}(d[e],e,d)},before:function(b,c){a.aspect.around(b,function(b){return c.apply(a.aspect.namespace,b.arguments),a.aspect.next(b)})},after:function(b,c){a.aspect.around(b,function(b){var d=a.aspect.next(b);return c.apply(a.aspect.namespace,b.arguments),d})},next:function(b){return b.fn.apply(a.aspect.namespace,b.arguments)}},a.inject=function(b){a.aspect.namespace=b,a.aspect.attach()},a.module=function(c,e){d("info","module name:"+c),this.modules=this.modules||{};var f=this.modules[c];if(f)return f;var g={namespace:b,dependencies:{},waiting:[],process:function(a,b){var c=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,d=/,/,f=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,g=a.toString().replace(f,""),h=g.match(c),i=h[1].split(d).map(function(a){return a.trim()}),j=b||i;if(this.isRegistered(j))a.apply(a,this.getArrayDependencies(j));else{var k={target:a,args:j};this.waiting.push(k)}},isRegistered:function(a){var b=!0;d("info","isRegistered args:",a);for(var c in a){var e=a[c];if(!this.getDependencies()[e]){d("warn","Dependency not registered when called:",e),b=!1;break}}return b},getArrayDependencies:function(a){var b=this.getDependencies();return a.map(function(a){return b[a].__instance?new b[a]:b[a]})},getDependencies:function(a){return this.dependencies[a||this.namespace]||{}},register:function(a,b,c){this.getDependencies()[a]=b,c&&(this.getDependencies()[a].__instance=c),this.service()},service:function(){for(var a in this.waiting){var b=this.waiting[a];this.isRegistered(b.args)&&(b.target.apply(b.target,this.getArrayDependencies(b.args)),delete this.waiting[a])}}};if(g.namespace=c,g.dependencies[c]={},e){var h=function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];if(this.modules[e]){var f=this.modules[e];b.push(f);for(var h in f.services)g.register(h,f.services[h],1);for(var i in f.factories)g.register(i,f.factories[i]())}}}.bind(this);h(e)}return this.modules[c]=new function(){this.name=c,this.config=function(a){g.process(a)},this.service=function(a,b){this.services=this.services||{},this.services[a]=this.services[a]||b,g.register(a,b,1)},this.factory=function(a,b){this.factories=this.factories||{},this.factories[a]=this.factories[a]||b,g.register(a,this.factories[a]())},this.control=function(a,b){this.controls=this.controls||{},g.register("Scope",this.getScope(a));var c=null;if("function"!=typeof b){c=b;var d=c.pop(),e=d.toString(),f=e.substring(e.indexOf("{")+1,e.lastIndexOf("}"));b=new Function(c.join(),f)}this.fire("mag.control.process.begin",[a]),g.process(b,c),this.fire("mag.control.process.end",[a])},this.getScope=function(a){return this.controls=this.controls||{},this.controls[a]=this.controls[a]||{}},this.observers={},this.on=function(a,b){for(a=a.split(/\s+/);eventName=a.shift();)this.observers[eventName]||(this.observers[eventName]=[]),this.observers[eventName].push(b)},this.fire=function(a,b){if(this.observers[a])for(var c=0;c<this.observers[a].length;c++)this.observers[a][c].apply(this,b)},a.inject(this)}}}(window.mag={});
!function(){var c=Object.prototype.toString;mag.template.serve=function(a){mag.aspect.next(a);var b=a.arguments[0],c=this.getScope(b),d=this;mag.template.parse(d,b,c)},mag.template.parse=function(a,b,d){var e=document.getElementById(b);if(this.templates=this.templates||{},this.templates[b]=this.templates[b]||e?e.innerHTML:null,this.template=this.templates[b],e&&""!=this.template){var f=e.parentNode;e.parentNode.removeChild(e),this.applyVar=function(a,b,c){if(a.nodeType){var d=a.getElementsByClassName(b),e=d.length;for(1>e&&this.setVar(a,b,c);e--;)this.setVar(a,b,c,d,e)}},this.setVar=function(a,b,c,d,e){var f="function"==typeof c[b]?c[b].call(this):c[b];d&&(d[e].innerText=f),a.innerHTML=a.innerHTML.replace(/\[\[(.*?)\]\]/g,function(a,c){return b==c?f:a})},this.applyVars=function(a,b){for(var c in b)this.applyVar(a,c,b)},this.parser=function(a,b){for(var d in b)if("[object Array]"===c.call(b[d])){var e=a.getElementsByClassName(d);if(!e[0])return;for(var f=e[0].cloneNode(!0),g=b[d],h=0;h<g.length;h++){var i=f.cloneNode(!0);g[h],this.applyVars(i,g[h]),e[0].parentNode.appendChild(i)}e[0].parentNode.removeChild(e[0])}else this.applyVar(a,d,b)},this.parser(e,d),f.appendChild(e)}},mag.aspect.add("around","control",mag.template.serve)}(window.mag=window.mag||{},mag.template={});
