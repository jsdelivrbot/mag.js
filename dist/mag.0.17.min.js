/*
Mag.JS v0.17
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(t,n){function e(t){var e=n.getElementById(t);if(!e)throw Error("invalid node id: "+t);return e}var i={attributes:[],elementMatcher:[]},r=[];t.build=function(n,e,i){var r=function(r,o){return"string"!=typeof r&&(o=[].concat(r)[0],r=0),t.module(r||n,e,t.utils.copy(t.utils.merge(o||{},i||{})))};return r.toJSON=function(){},r.getState=function(){},r.toHTML=function(){},r},t.module=function(n,i,r){r=r||{};var o;if(!(o=!t.utils.items.isItem(n))){o=t.utils.items.getItem(n);var u=e(n);o=!t.utils.callLCEvent("onreload",t.mod.getState(o),u,o)}return o&&(o=r.key&&t.utils.items.isItem(n+".".props.key)||t.utils.getItemInstanceId(n),t.mod.submodule(o,i,r),u=e(n),l(o,n),!t.utils.callLCEvent("willload",t.mod.getState(o),u,o,1))?(n=t.mod.getState(o),t.utils.unloaders[o]=t.utils.unloaders[o]||[],n.onunload&&t.utils.unloaders[o].push({controller:n,handler:n.onunload}),t.redraw(u,o,1),t.utils.callLCEvent("didload",t.mod.getState(o),u,o,1),a(o,u,i,r)):void 0},t.redraw=function(n,e,i){t.fill.configs.splice(0,t.fill.configs.length),n=u(n,e,i),r.push(n),t.utils.throttle.redrawing||t.utils.throttle(function(){if(!t.utils.throttle.redrawing)for(console.log("RUN",o++);0<r.length;)r.shift()()})};var o=0;t.hookin=function(t,n,e){i[t].push({context:{},handler:e,key:n})},t.hook=function(n,e,r){for(var o=0,a=i[n].length;a>o;o++)t.utils.callHook(i,e,n,o,r)};var a=function(n,e,i,r){return function(n,e,i,r,o){return n=e.cloneNode(1),n.id=e.id+"."+o,e=t.utils.getItemInstanceId(n.id),t.mod.submodule(e,i,r),l(e,n.id),t.redraw(n,e,1),n}.bind({},n,e,i,r)},l=function(n,i){t.prop.setup(t.mod.getState(n),function(n,i){t.redraw(e(i),n)}.bind({},n,i))},u=function(n,e,i){return function(n,e,i){var r=t.mod.getState(e);if(!t.utils.callLCEvent("isupdate",r,n,e)){if(t.mod.iscached(e,r)&&!i)return 0;if(!t.utils.callLCEvent("willupdate",r,n,e)){t.mod.callView(n,e),i=n.style.display||"",n.style.display="none",n=t.fill.run(n,r),n.style.display=i,i=n.id;var o,a=t.fill.configs;for(o in a)-1<o.indexOf('id("'+i+'")/')&&a[o]();o=n.id;for(var l in t.fill.cached)-1<l.indexOf('id("'+o+'")/')&&-1<l.indexOf("-config")&&t.fill.cached[l].configContext&&(t.utils.unloaders[e]=t.utils.unloaders[e]||[],t.utils.unloaders[e].push({controller:t.fill.cached[l].configContext,handler:t.fill.cached[l].configContext.onunload}));t.utils.callLCEvent("didupdate",r,n)}}}.bind({},n,e,i)};window.mag=t}(window.mag||{},document),function(t){var n=[],e=[],i={getState:function(t){return n[t][1]},setState:function(t,e){n[t][1]=e},getView:function(t){return n[t][0]},submodule:function(t,e,i){return n[t]?n[t]:n[t]=[function(t,n){e.view.call(e,t,[].concat(i)[0],n)},new function(){return(e.controller||function(){}).call(this,[].concat(i)[0])||this}]},iscached:function(t,n){return e[t]&&e[t]===JSON.stringify(n)?!0:void(e[t]=JSON.stringify(n))},callView:function(n,e){var r=i.getView(e);t.prop.attachToArgs(e,i.getState(e),n),r(i.getState(e),n)}};t.mod=i}(window.mag||{}),function(t){function n(t){var e,i=Object.getNotifier(t),o=function(t){t.forEach(function(t){i.notify(t)})};for(e in t){var a=t[e];if(!a||"object"!=typeof a)break;void 0!==Array.observe&&Array.isArray(a)?Array.observe(a,o,r):Object.observe(a,o,r),n(a)}}function e(t){for(var n in t)if(t[n]&&-1!==["INPUT","SELECT","TEXTAREA"].indexOf(t[n].tagName))return t[n];return!1}var i={setup:function(t,e){t&&void 0!==Object.observe&&(n(t),Object.observe(t,e,r))}},r=["add","update","delete"],o=function(n,e){for(var i=1;i<n.length;i+=2){var r=n[i+1];e=t.fill.find(e,n[i]),e=e[r]}return e},a=function(n,i,r,a){return n=(""+r).split("."),3>n.length?(n=parseInt(n.pop()),n=isNaN(n)?0:n,i=t.fill.find(a[n]?a[n]:a,i)):(a=o(n,a),i=t.fill.find(a,i)),(i=e(i))&&!i.eventOnFocus&&(i.addEventListener("focus",function(){this.classList.contains("ion-dirty")||this.classList.add("ion-dirty")},!1),i.eventOnFocus=!0),i},l=function(n,i,r,o){var l=r[i];"_value"===i&&(i=n.split(".").pop());var u=t.fill.find(o,i),u=e(u);if("function"!=typeof l&&u){var f=a.bind({},r,i,n,o);f(),Object.defineProperty(r,i,{configurable:!0,get:function(){var e=f();return e&&"undefined"!==e.value&&e.classList.contains("ion-dirty")&&e.value!==l?(l=e.value,t.redraw(o,n),e.value):l},set:function(t){var n=f();n&&"undefined"!==n.value&&n.value!==t&&t!==l&&(n.value=t,l=t)}})}},u=function(t,n,e){for(var i in n){var r=n[i];"object"==typeof r?u(t+"."+i,r,e):l.bind({},t,i,n,e)()}};i.attachToArgs=u,t.prop=i}(window.mag||{}),function(t){var n={},e=null,i=window.cancelAnimationFrame||window.clearTimeout,r=window.requestAnimationFrame||window.setTimeout;n.callHook=function(t,n,e,i,r,o){r.change=!1,t[e][i].key==n&&(o=JSON.stringify({v:r.value,k:r.key}),t[e][i].handler.call(t[e][i].context,r),o!==JSON.stringify({v:r.value,k:r.key})&&(r.change=!0))},n.throttle=function(t,o){if(!n.throttle.redrawing){n.throttle.redrawing=!0;try{e&&!o?(r===window.requestAnimationFrame||16<new Date-0)&&(e>0&&i(e),e=r(t,16)):(t(),e=r(function(){e=null},16))}finally{n.throttle.redrawing=!1}}},n.throttle.redrawing=!1,n.unloaders=[],n.callLCEvent=function(t,e,i,r,o){var a=!1,l={preventDefault:function(){a=!0}};if(e&&e[t]&&(e[t].call({},l,i),o&&(e[t]=0)),a)for(e=0;t=n.unloaders[r][e];e++)t.controller.onunload&&(t.handler.call(t.controller,i),t.controller.onunload=0);return a},n.copy=function(t){var e,i,r;e=Array.isArray(t)?[]:{};for(r in t)i=t[r],e[r]="object"==typeof i?n.copy(i):"function"==typeof i?i():i;return e},n.merge=function(t,n){for(var e in t)n[e]=t[e];return n};var o={i:[],isItem:function(t){return-1<o.i.indexOf(t)},setItem:function(t){o.i[o.i.length]=t},getItem:function(t){return o.i.indexOf(t)},removeItem:function(t){o.i.splice(o.i.indexOf(t),1)}};n.items=o,n.getItemInstanceIdAll=function(){return o.i},n.getItemInstanceId=function(t){return o.isItem(t)?o.getItem(t):(o.setItem(t),o.getItem(t))},t.utils=n}(window.mag||{}),function(t,n){function e(t){return"[object Array]"==={}.toString.call(t)}function i(t){if(""!==t.id)return'id("'+t.id+'")';if(t===document.body)return t.tagName;var n=0;if(t.parentNode)for(var e=t.parentNode.childNodes,r=0;r<e.length;r++){var o=e[r];if(o===t)return i(t.parentNode)+"/"+t.tagName+"["+(n+1)+"]";1===o.nodeType&&o.tagName===t.tagName&&n++}}function r(t){var n=i(t);t.parentNode.removeChild(t),p[n+"-config"]&&p[n+"-config"].configContext&&typeof p[n+"-config"].configContext.onunload===y&&p[n+"-config"].configContext.onunload(p[n+"-config"].configContext,t,n)}function o(t){return(t=t&&parseInt(t.split("[").pop().slice(0,-1)))?parseInt(t)-1:0}function a(t){return t.parentNode&&t.parentNode[m]&&t.parentNode[m].isChildOfArray?t.parentNode:t.parentNode?a(t.parentNode):void 0}function l(t,n,o){var a,u;if("function"==typeof n)return n=n(o),n.nodeType&&n.nodeType==h?(t.firstChild?t.replaceChild(n,t.firstChild):t.appendChild(n),function(t){console.log("called again",t)}.bind({},n.id)):(a=/<[a-z][\s\S]*>/i.test(n)?"_html":"_text",u={},u[a]=n,l(t,u));if("object"!=typeof n)return l(t,{_text:n});for(var c in n)o=n[c],void 0===o?o="":null===o&&-1===["onunload"].indexOf(c)&&s(t,c).forEach(function(t){r(t)}),"_"===c[0]&&(a=a||{},a[c.substr(1)]=o);var d=i(t);a&&f(t,a);for(c in n)o=n[c],-1===w.indexOf(c)&&"_"!==c[0]&&(u=s(t,c),e(o)&&(u=s(t,"$"+c)),g.run(u,o,d+"/"+c))}function u(t){var n;if(null==t.length&&(t=[t]),!e(t)){n=[];for(var i=0;i<t.length;i+=1)t[i]&&n.push(t[i]);t=n}return t}function f(e,r){var l,u=i(e),f=o(u);for(l in r)if("text"!==l&&"html"!==l)if(0==l.indexOf("on")){var s=function(t,n,e){var r=a(n),l=r&&i(r),u=o(l),f=i(n),f=o(f);return t.call(n,e,f,n,{path:l,data:((r||{})[m]||[]).dataPass,node:r,index:u})}.bind({},r[l],e);e[l]=s}else if("config"==l){s=!0,p[u+"-config"]?s=!1:p[u+"-config"]={};var v=p[u+"-config"].configContext=p[u+"-config"].configContext||{};n[u]=function(t,n){return function(){return t.apply(t,n)}}(r[l],[e,s,v,f])}else s={key:l,value:r[l],node:e},t.hook("attributes",l,s),s.change&&(l=s.key,r[l]=s.value),null===r[l]?e.removeAttribute(l):e.setAttribute(l,""+r[l]);c(e,r.text),d(e,r.html,f)}function c(t,n){var e,i;if(t&&null!=n){if(!i){i=[];for(var r=0;r<t.childNodes.length;r+=1)e=t.childNodes[r],e.nodeType===h&&i.push(e)}for(;t.firstChild;)t.removeChild(t.firstChild);for("INPUT"===t.nodeName?t.setAttribute("value",""+n):t.appendChild(t.ownerDocument.createTextNode(""+n)),r=0;r<i.length;r+=1)t.appendChild(i[r]);"SELECT"===t.nodeName&&(t.value=""+n)}}function d(t,n){t&&null!=n&&(t.innerHTML=n)}function s(n,e,i){var r=[];if(n){var o=n.childNodes;if(o)for(var a=0;a<o.length;a+=1)o[a].nodeType===h&&r.push(o[a])}var o=[],a=e,l="$"===e[0];"$"===a[0]&&(a=a.substr(1));for(var u=0;u<r.length;u+=1){var f=r[u],c=a,d=" "+f.className+" ";(f.id===c||-1<d.indexOf(" "+c+" ")||f.name===c||f.nodeName.toLowerCase()===c.toLowerCase()||f.getAttribute("data-bind")===c)&&o.push(r[u])}if(!o.length||l)for(u=0;u<r.length&&(o=o.concat(s(r[u],e,!0)),!o.length||l);u++);return i||o.length||(n={key:e,value:o,node:n},t.hook("elementMatcher",e,n),n.change&&(o=n.value)),o}function v(t,n){if(n={tag:t.tagName},n.children=[],t.firstChild||t.children[0]){var e=t.firstChild||t.childNodes[0];(e=e.nodeValue||e.value||e.innerText)&&(e=e.replace(/\u00a0/g,"x").trim()),e&&n.children.push(e)}for(e=0,n.attrs={},e;e<t.attributes.length;e++)n.attrs[t.attributes[e].name]=t.attributes[e].value;var i=t.children;if(i.length)for(e=0;e<i.length;e++)n.children.push(v(i[e],n.children));return n}var g={},h=1,p=[],m="__magnum__",y="function",w=["willupdate","didupdate","didload","willload","isupdate"],b={};g.run=function(t,n,a){var f,c,d;if(t){null==n&&(n={_text:""});var s=u(t);if(d=e(n)){if(b[a]&&0===s.length&&(b[a].parent.insertAdjacentHTML("beforeend",b[a].node),s=u(b[a].parent.children)),0===s.length)return;for(c=s[0].parentNode,b[a]||(b[a]={node:s[0].cloneNode(!0).outerHTML,parent:c});s.length<n.length;)b[a]?(c.insertAdjacentHTML("beforeend",b[a].node),f=c.lastChild):f=s[0].cloneNode(!0),s.push(f),c&&c.appendChild(f);if(s.map(function(t){return t.__key}),f=n.map(function(t){return t._key}),(s.length==n.length||-1!==f.indexOf(void 0))&&(n=n.map(function(t,n){if("object"==typeof t){if(s[n].__key&&void 0===t._key)return t._key=s[n].__key,t;void 0===t._key&&(t._key=m+n),s[n].__key=t._key}return t})),s.length>n.length)if(0===n.length||"object"!=typeof n[0])for(;s.length>n.length;)f=s.pop(),(c=f.parentNode)&&r(f);else var v=[],h=n.map(function(t){return t._key}),s=(s.map(function(t){return t.__key}),s.filter(function(t){return-1===h.indexOf(t.__key)||-1!==v.indexOf(t.__key)?(v.push(t.__key),r(t),!1):(v.push(t.__key),!0)}))}for(f=0;f<s.length;f++)i(s[f]),d?s[f]&&g.run(s[f],n[f]):(n&&"object"==typeof n&&-1!==Object.keys(n).indexOf("_key")&&(s[f][m]=s[f][m]||{},s[f][m].isChildOfArray=!0,s[f][m].dataPass=n),c=o(a),l(s[f],n,c));return t}},g.elementToObject=v,g.cached=p,g.configs=n,g.find=s,t.fill=g}(window.mag||{},[]);
