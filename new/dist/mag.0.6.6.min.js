/*
* MagnumJS - By Michael Glazer April 2015
* https://github.com/magnumjs/mag.js
*/
!function(e,n,t,r){function o(e){if(""!==e.id)return'id("'+e.id+'")';if(e===t.body)return e.tagName;for(var n=0,r=e.parentNode.childNodes,i=0;i<r.length;i++){var a=r[i];if(a===e)return o(e.parentNode)+"/"+e.tagName+"["+(n+1)+"]";1===a.nodeType&&a.tagName===e.tagName&&n++}}function i(e,n,t){var r,c,u;if(e){null==n&&(n={_text:""});var s=l(e);if(u="[object Array]"===Object.prototype.toString.call(n)){if(d[t]&&0===s.length&&(d[t].parent.insertAdjacentHTML("beforeend",d[t].node),s=l(d[t].parent.children)),0===s.length)return;for(c=s[0].parentNode,d[t]||(d[t]={node:s[0].cloneNode(!0).outerHTML,parent:c});s.length<n.length;)d[t]?(c.insertAdjacentHTML("beforeend",d[t].node),r=c.lastChild):r=s[0].cloneNode(!0),s.push(r),c&&c.appendChild(r);for(;s.length>n.length;)r=s.pop(),(c=r.parentNode)&&c.removeChild(r)}for(t=0;t<s.length;t++)r=o(s[t]),u?!s[t]||h[r]&&h[r]===JSON.stringify(n[t])||(i(s[t],n[t]),h[r]=JSON.stringify(n[t])):a(s[t],n);return e}}function a(e,n){var t;if("function"!=typeof n){if("object"!=typeof n)return a(e,{_text:n});for(var l in n){var u=n[l];u===r&&(u=""),"_"===l[0]&&(t=t||{},t[l.substr(1)]=u)}var s=o(e);if(t){if(h[s]&&h[s]===JSON.stringify(t))return;c(e,t),h[s]=JSON.stringify(t)}var d=0;for(l in n)if(u=n[l],"_"!==l[0]){if(t=f(e,l),"function"==typeof u&&"fun"==u.type)try{u=u()}catch(p){}i(t,u,s),d++}}}function l(e){var n;if(null==e.length&&(e=[e]),"[object Array]"!==Object.prototype.toString.call(e)){n=[];for(var t=0;t<e.length;t+=1)e[t]&&n.push(e[t]);e=n}return e}function c(t,r){u(t,r.text),s(t,r.html),t._events=t._events||[];for(var o in r)if("text"!==o&&"html"!==o)if(0==o.indexOf("on")){if(-1===t._events.indexOf(o)){var i=function(n,t,r){n.call(t,r),e.redraw()}.bind(null,r[o],t);t.addEventListener(o.substr(2),i),t._events.push(o)}}else"config"==o?n.push(function(e,n){return function(){return e.apply(e,n)}}(r[o],[t,!0])):null===r[o]?t.removeAttribute(o):t.setAttribute(o,""+r[o])}function u(e,n){var t,r;if(e&&null!=n){if(!r){r=[];for(var o=0;o<e.childNodes.length;o+=1)t=e.childNodes[o],1===t.nodeType&&r.push(t)}for(;e.firstChild;)e.removeChild(e.firstChild);for("input"===e.nodeName.toLowerCase()?e.setAttribute("value",""+n):e.appendChild(e.ownerDocument.createTextNode(""+n)),o=0;o<r.length;o+=1)e.appendChild(r[o])}}function s(e,n){e&&null!=n&&(e.innerHTML=n)}function f(e,n,t){var r=e.childNodes;t=[];for(var o=0;o<r.length;o+=1)1===r[o].nodeType&&t.push(r[o]);if(r=[],o=n,!(e.queryCache||{})[n]){e.queryCache=(e.queryCache||{})[n]=[];var i="$"===n[0];"$"===o[0]&&(o=o.substr(1));for(var a=0;a<t.length;a+=1){var l=t[a],c=o,u=" "+l.className+" ";(l.id===c||-1<u.indexOf(" "+c+" ")||l.name===c||l.nodeName.toLowerCase()===c.toLowerCase()||l.getAttribute("data-bind")===c)&&r.push(t[a])}if(!r.length||i)for(a=0;a<t.length&&(r=r.concat(f(t[a],n,!0)),!r.length||i);a++);e.queryCache[n]=r}return e.queryCache[n]}var h=[],d={},h=[];e.fill={fill:i,configs:n},window.mag=e}(window.mag||{},[],document),function(e){function n(){_=null;for(var e=0;e<b.length;e++)b[e]();b.length=0}var t={noMore:!1,useDirtyCheck:!1},r=[],o=[],i=[],a=!1;try{a=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(l){}var c=function(e){var n={};return e&&"[object Function]"==n.toString.call(e)},u=function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=function(e){return"[object Object]"==={}.toString.apply(e)},f=function(e){if(null==e||"object"!=typeof e)return e;var n,t=e.constructor();for(n in e)t[n]=e[n];return t},h=function(e,n,t,r){try{Object.observe(e,function(e){e.forEach(function(e){e.name===n&&r(e.object[e.name])})})}catch(o){try{Object.defineProperty(e,n,{get:t,set:function(e){r.call(this,e,!0)},enumerable:!0,configurable:!0})}catch(i){try{Object.prototype.__defineGetter__.call(e,n,t),Object.prototype.__defineSetter__.call(e,n,function(e){r.call(this,e,!0)})}catch(a){p(e,n,r)}}}},d=function(e,n,t){try{Object.defineProperty(e,n,{enumerable:!1,configurable:!0,writable:!1,value:t})}catch(r){e[n]=t}},p=function(e,n,t){o[o.length]={prop:n,object:e,orig:f(e[n]),callback:t}},g=function(e,n,t,r){if("string"!=typeof e&&(e instanceof Object||u(e))){if(u(e)){if(S(e,"__watchall__",n,t),void 0===t||t>0)for(var o=0;o<e.length;o++)g(e[o],n,t,r)}else{var i=[];for(o in e)"$val"==o||!a&&"watchers"===o||Object.prototype.hasOwnProperty.call(e,o)&&i.push(o);v(e,i,n,t,r)}r&&M(e,"$$watchlengthsubjectroot",n,t)}},v=function(e,n,t,r,o){if("string"!=typeof e&&(e instanceof Object||u(e)))for(var i=0;i<n.length;i++)w(e,n[i],t,r,o)},w=function(e,n,t,r,o){"string"!=typeof e&&(e instanceof Object||u(e))&&!c(e[n])&&(null!=e[n]&&(void 0===r||r>0)&&g(e[n],t,void 0!==r?r-1:r),S(e,n,t,r),o&&(void 0===r||r>0)&&M(e,n,t,r))},m=function(e,n){if(!(e instanceof String)&&(e instanceof Object||u(e)))if(u(e)){for(var t=["__watchall__"],r=0;r<e.length;r++)t.push(r);y(e,t,n)}else{var o=function(e){var t,r=[];for(t in e)e.hasOwnProperty(t)&&(e[t]instanceof Object?o(e[t]):r.push(t));y(e,r,n)};o(e)}},y=function(e,n,t){for(var r in n)n.hasOwnProperty(r)&&$(e,n[r],t)},b=[],_=null,j=function(){return _||(_=setTimeout(n)),_},O=function(e){null==_&&j(),b[b.length]=e},N=function(e,n,t,r){var o=null,i=-1,a=u(e);g(e,function(t,r,l,c){var u=j();if(i!==u&&(i=u,o={type:"update"},o.value=e,o.splices=null,O(function(){n.call(this,o),o=null})),a&&e===this&&null!==o){if("pop"===r||"shift"===r)l=[],c=[c];else if("push"===r||"unshift"===r)l=[l],c=[];else if("splice"!==r)return;o.splices||(o.splices=[]),o.splices[o.splices.length]={index:t,deleteCount:c?c.length:0,addedCount:l?l.length:0,added:l,deleted:c}}},1==t?void 0:0,r)},C=function(e,n,t,r,o){e&&n&&(w(e,n,function(e,n,i,a){e={type:"update"},e.value=i,e.oldvalue=a,(r&&s(i)||u(i))&&N(i,t,r,o),t.call(this,e)},0),(r&&s(e[n])||u(e[n]))&&N(e[n],t,r,o))},S=function(e,n,r,o){var i=!1,a=u(e);for(e.watchers||(d(e,"watchers",{}),a&&x(e,function(t,r,i,a){if(J(e,t,r,i,a),0!==o&&i&&(s(i)||u(i))){var l,c;for(t=e.watchers[n],(a=e.watchers.__watchall__)&&(t=t?t.concat(a):a),c=t?t.length:0,a=0;c>a;a++)if("splice"!==r)g(i,t[a],void 0===o?o:o-1);else for(l=0;l<i.length;l++)g(i[l],t[a],void 0===o?o:o-1)}})),e.watchers[n]||(e.watchers[n]=[],a||(i=!0)),a=0;a<e.watchers[n].length;a++)if(e.watchers[n][a]===r)return;if(e.watchers[n].push(r),i){var l=e[n];r=function(){return l},i=function(r,i){var a=l;if(l=r,0!==o&&e[n]&&(s(e[n])||u(e[n]))&&!e[n].watchers){var c,f=e.watchers[n].length;for(c=0;f>c;c++)g(e[n],e.watchers[n][c],void 0===o?o:o-1)}e.watchers&&(e.watchers.__wjs_suspend__||e.watchers["__wjs_suspend__"+n])?P(e,n):t.noMore||a===r||(i?J(e,n,"set",r,a):A(e,n,"set",r,a),t.noMore=!1)},t.useDirtyCheck?p(e,n,i):h(e,n,r,i)}},A=function(e,n,t,r,o){if(void 0!==n){var i,a=e.watchers[n];(i=e.watchers.__watchall__)&&(a=a?a.concat(i):i),i=a?a.length:0;for(var l=0;i>l;l++)a[l].call(e,n,t,r,o)}else for(n in e)e.hasOwnProperty(n)&&A(e,n,t,r,o)},T="pop push reverse shift sort slice unshift splice".split(" "),L=function(e,n,t,r){d(e,t,function(){var o,i,a,l=0;if("splice"===t){for(a=arguments[0],i=e.slice(a,a+arguments[1]),o=[],l=2;l<arguments.length;l++)o[l-2]=arguments[l];l=a}else o=0<arguments.length?arguments[0]:void 0;return a=n.apply(e,arguments),"slice"!==t&&("pop"===t?(i=a,l=e.length):"push"===t?l=e.length-1:"shift"===t?i=a:"unshift"!==t&&void 0===o&&(o=a),r.call(e,l,t,o,i)),a})},x=function(e,n){if(c(n)&&e&&!(e instanceof String)&&u(e))for(var t,r=T.length;r--;)t=T[r],L(e,e[t],t,n)},$=function(e,n,t){if(e.watchers[n])if(void 0===t)delete e.watchers[n];else for(var i=0;i<e.watchers[n].length;i++)e.watchers[n][i]==t&&e.watchers[n].splice(i,1);for(i=0;i<r.length;i++){var a=r[i];a.obj==e&&a.prop==n&&a.watcher==t&&r.splice(i,1)}for(t=0;t<o.length;t++)i=o[t],a=i.object.watchers,(i=i.object==e&&i.prop==n&&a&&(!a[n]||0==a[n].length))&&o.splice(t,1)},P=function(e,n){O(function(){delete e.watchers.__wjs_suspend__,delete e.watchers["__wjs_suspend__"+n]})},k=null,J=function(e,n,t,r,o){i[i.length]={obj:e,prop:n,mode:t,newval:r,oldval:o},null===k&&(k=setTimeout(q))},q=function(){var e=null;k=null;for(var n=0;n<i.length;n++)e=i[n],A(e.obj,e.prop,e.mode,e.newval,e.oldval);e&&(i=[])},M=function(e,n,t,o){var i;i=f("$$watchlengthsubjectroot"===n?e:e[n]),r.push({obj:e,prop:n,actual:i,watcher:t,level:o})};t.watch=function(){c(arguments[1])?g.apply(this,arguments):u(arguments[1])?v.apply(this,arguments):w.apply(this,arguments)},t.unwatch=function(){c(arguments[1])?m.apply(this,arguments):u(arguments[1])?y.apply(this,arguments):$.apply(this,arguments)},t.callWatchers=A,t.suspend=function(e,n){e.watchers&&(e.watchers["__wjs_suspend__"+(void 0!==n?n:"")]=!0)},t.onChange=function(){(c(arguments[2])?C:N).apply(this,arguments)},e.watch=t}(window.mag||{}),function(e){var n={modules:[],controllers:[],elements:[],submodule:function(e,n){var t=function(n){return(e.controller||function(){}).apply(this,n)}.bind({},n);return t.$original=e.controller,t={controller:t,view:function(t){1<arguments.length&&(n=n.concat([].slice.call(arguments,1)));var r=e.view.apply(e,n?[t].concat(n):[t]);return n[0]&&null!=n[0].key&&(r.attrs.key=n[0].key),r}},n[0]&&null!=n[0].key&&(t.attrs={key:n[0].key}),t},getArgs:function(e){return n.modules[e].controller&&n.modules[e].controller.$$args?[n.controllers[e]].concat(n.modules[e].controller.$$args):[n.controllers[e]]}};e.mod=n}(window.mag||{}),function(e){var n={roots:[],templates:{},cache:{},callOnload:function(e,n){n&&e.controllers[n].onload&&!e.controllers[n].called&&(e.controllers[n].onload.call(null,e.elements[n]),e.controllers[n].called=1)},callConfigs:function(e){for(var n=0,t=e.length;t>n;n++)e[n]()}},t=[];n.redraw=function(e,t,r,o){e=e||n.module||{},i(function(){t.configs.splice(0,t.configs.length),n.doLoop(e,t,r,o)})()},n.doLoop=function(t,r,o,i){for(var a=0;n.roots[a];a++)e.running=!0,t.controllers[a]&&n.innerLoop(t,r,a,o,i)},n.innerLoop=function(e,r,o,i,a){var l=e.elements[o],c=e.getArgs(o);t[o]&&t[o]===JSON.stringify(c[0])||(e.getArgs(o),e.modules[o].view(l,e.controllers[o]),t[o]=JSON.stringify(c[0]),n.setupWatch(i,c,r,l,o,e),r.fill(l,c[0]),n.callConfigs(r.configs),a&&a(l))},n.doWatch=function(r,o,i,a,l){e.running=!0,l=a.getArgs(i),t[i]&&t[i]===JSON.stringify(l[0])||(a.getArgs(i),a.modules[i].view(o,a.controllers[i]),t[i]=JSON.stringify(l[0]),r.fill(o,l[0]),n.callConfigs(r.configs),n.callOnload(a),e.running=!1)},n.setupWatch=function(e,t,r,o,a,l){e.watch(t[0],i(n.doWatch.bind(null,r,o,a,l)))};var r=window.cancelAnimationFrame||window.clearTimeout,o=window.requestAnimationFrame||window.setTimeout,i=function(e,n){var t,i,a=n||16;return function(){+new Date-t>a||o===window.requestAnimationFrame?(i>0&&r(i),i=o(function(){t=+new Date,e.apply(this,arguments)},a)):(t=+new Date,e.apply(this,arguments))}};e.render=n}(window.mag||{}),function(e,n,t){var r,o={},i=e.mod,a=e.render,l=e.fill,c=e.watch;e.running=!1,o.init=function(){};var u=!1;o.redraw=function(e){u||(u=!0,a.redraw(i||a.module||{},l,c,e),u=!1)},o.withProp=function(e,n){return function(t){t=t||event,t=t.currentTarget||this,n(e in t?t[e]:t.getAttribute(e))}},o.prop=function(e){var n=function(){return arguments.length&&(e=arguments[0],o.redraw()),e};return n.type="fun",n.toJSON=function(){return e},n},o.module=function(e,t,l){var c=a.roots.indexOf(e);if(0>c&&(c=a.roots.length),e=n.getElementById(e),!e)return Error("invalid node");var u=e.parentNode;if(!u)return Error("no parent");var s=e.nextSibling;if(a.roots[c]=e.id,!t.view)return Error("module requires a view");l=r=t=(t=i.submodule(t,[l||{}]))||{};var f=new t.controller;return l===r&&(i.controllers[c]=f,i.modules[c]=t,i.elements[c]=e),c=function(e,n,t,r){a.callOnload(i,t);try{e.insertBefore(r,n)}catch(o){console.log(o)}}.bind(null,u,s,c),o.redraw(c),{_html:e.innerHTML}},t=function(e){return function(){return o[e].apply(this,arguments)}};var s=t("init");s.module=t("module"),s.prop=t("prop"),s.redraw=t("redraw"),s.withProp=t("withProp");for(var f in s)e[f]=s[f]}(window.mag||{},document);
