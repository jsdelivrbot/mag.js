/*
* MagnumJS - By Michael Glazer March 2015
* https://github.com/magnumjs/mag.js
*/
var mag=(function(a,j,k,d){var h=1;var i=[];function f(s){return Object.prototype.toString.call(s)==="[object Array]"}function e(s){if(typeof m.logger==="function"){m.logger(s)}}var b={};function m(u,w,B,y){var t;var A;var z;if(!u){return}if(w==null){w={_text:""}}var s=c(u);z=f(w);if(z){if(s.length===0){return}A=s[0].parentNode;var x=k.createDocumentFragment();s[0].setAttribute("data-clone",B+y);while(s.length-1<w.length){t=s[0].cloneNode(true);t.removeAttribute("data-clone");s.push(t);if(A){x.appendChild(t)}}while(s.length>w.length+1){t=s.pop();A=t.parentNode;if(A){x.removeChild(t)}}if(A){A.appendChild(x)}}for(var v=0;v<s.length;v++){if(z){if(s[v+1]){m(s[v+1],w[v])}}else{p(s[v],w)}}return u}function p(t,v){var u,x,w,s;if(typeof v==="function"){if(v._type=="__mag__.fun"){return p(t,v())}return}if(typeof v==="object"&&v._type=="__mag__.module"){return p(t,{_html:k.getElementById(v._ele).innerHTML})}if(typeof v!=="object"){return p(t,{_text:v})}for(var B in v){var A=v[B];if(A===d){A=""}if(B[0]==="_"){u=u||{};u[B.substr(1)]=A}}if(u){o(t,u)}var y=0;for(var B in v){var A=v[B];if(B[0]!=="_"){s=g(t,B);if(typeof A==="function"&&A.type=="fun"){try{A=A()}catch(z){}}m(s,A,B,y);y++}}}function c(t){var s;if(t.length==null){t=[t]}if(!f(t)){s=[];for(var u=0;u<t.length;u+=1){if(t[u]){s.push(t[u])}}t=s}return t}function o(v,t){n(v,t.text);l(v,t.html);v._events=v._events||[];for(var u in t){if(u==="text"||u==="html"){continue}if(u.indexOf("on")==0){if(v._events.indexOf(u)!==-1){continue}v.addEventListener(u.substr(2),t[u]);v._events.push(u)}else{if(u=="fun"){}if(u=="config"){var s=true;var w=function(y,x){return function(){return y.apply(y,x)}};j.push(w(t[u],[v,s]));continue}if(t[u]===null){v.removeAttribute(u)}else{v.setAttribute(u,t[u].toString())}}}}function n(u,v){var w;var t;if(!u||v==null){return}if(!t){t=[];for(var s=0;s<u.childNodes.length;s+=1){w=u.childNodes[s];if(w.nodeType===h){t.push(w)}}}while(u.firstChild){u.removeChild(u.firstChild)}if(u.nodeName.toLowerCase()==="input"){u.setAttribute("value",v.toString())}else{u.appendChild(u.ownerDocument.createTextNode(v.toString()))}for(var s=0;s<t.length;s+=1){u.appendChild(t[s])}}function l(t,s){if(!t||s==null){return}t.innerHTML=s}function g(w,u,z){var y=q(w);var x=[];var v=u;if(!(w.queryCache||{})[u]){w.queryCache=(w.queryCache||{})[u]=[];var s=u[0]==="$";if(v[0]==="$"){v=v.substr(1)}for(var t=0;t<y.length;t+=1){if(r(y[t],v)){x.push(y[t])}}if(!x.length||s){for(var t=0;t<y.length;t++){x=x.concat(g(y[t],u,true));if(x.length&&!s){break}}}if(!z&&!x.length){e('FILL - Warning: no matches found for "'+u+'"')}w.queryCache[u]=x}return w.queryCache[u]}function q(u){var t=u.childNodes;var v=[];for(var s=0;s<t.length;s+=1){if(t[s].nodeType===h){v.push(t[s])}}return v}function r(t,s){var u=" "+t.className+" ";return(t.id===s||u.indexOf(" "+s+" ")>-1||t.name===s||t.nodeName.toLowerCase()===s.toLowerCase()||t.getAttribute("data-bind")===s)}a.fill={fill:m,configs:j};return a}(window.mag||{},[],document));"use strict";var mag=(function(I){var h={noMore:false,useDirtyCheck:false},c=[];var R=[];var B=[];var s=false;try{s=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(O){}var q=function(W){var X={};return W&&X.toString.call(W)=="[object Function]"};var S=function(W){return W%1===0};var A=function(W){return Object.prototype.toString.call(W)==="[object Array]"};var N=function(W){return{}.toString.apply(W)==="[object Object]"};var J=function(X,W){var ab=[],aa=[];if(!(typeof X=="string")&&!(typeof W=="string")){if(A(X)){for(var Z=0;Z<X.length;Z++){if(W[Z]===undefined){ab.push(Z)}}}else{for(var Z in X){if(X.hasOwnProperty(Z)){if(W[Z]===undefined){ab.push(Z)}}}}if(A(W)){for(var Y=0;Y<W.length;Y++){if(X[Y]===undefined){aa.push(Y)}}}else{for(var Y in W){if(W.hasOwnProperty(Y)){if(X[Y]===undefined){aa.push(Y)}}}}}return{added:ab,removed:aa}};var x=function(X){if(null==X||"object"!=typeof X){return X}var Y=X.constructor();for(var W in X){Y[W]=X[W]}return Y};var e=function(ab,Y,W,ac){try{Object.observe(ab,function(ad){ad.forEach(function(ae){if(ae.name===Y){ac(ae.object[ae.name])}})})}catch(aa){try{Object.defineProperty(ab,Y,{get:W,set:function(ad){ac.call(this,ad,true)},enumerable:true,configurable:true})}catch(Z){try{Object.prototype.__defineGetter__.call(ab,Y,W);Object.prototype.__defineSetter__.call(ab,Y,function(ad){ac.call(this,ad,true)})}catch(X){K(ab,Y,ac)}}}};var v=function(Z,Y,X){try{Object.defineProperty(Z,Y,{enumerable:false,configurable:true,writable:false,value:X})}catch(W){Z[Y]=X}};var K=function(X,W,Y){R[R.length]={prop:W,object:X,orig:x(X[W]),callback:Y}};var w=function(){if(q(arguments[1])){i.apply(this,arguments)}else{if(A(arguments[1])){u.apply(this,arguments)}else{U.apply(this,arguments)}}};var i=function(Z,W,ab,Y){if((typeof Z=="string")||(!(Z instanceof Object)&&!A(Z))){return}if(A(Z)){H(Z,"__watchall__",W,ab);if(ab===undefined||ab>0){for(var aa=0;aa<Z.length;aa++){i(Z[aa],W,ab,Y)}}}else{var aa,X=[];for(aa in Z){if(aa=="$val"||(!s&&aa==="watchers")){continue}if(Object.prototype.hasOwnProperty.call(Z,aa)){X.push(aa)}}u(Z,X,W,ab,Y)}if(Y){j(Z,"$$watchlengthsubjectroot",W,ab)}};var u=function(aa,Z,W,ac,Y){if((typeof aa=="string")||(!(aa instanceof Object)&&!A(aa))){return}for(var X=0;X<Z.length;X++){var ab=Z[X];U(aa,ab,W,ac,Y)}};var U=function(Y,aa,W,Z,X){if((typeof Y=="string")||(!(Y instanceof Object)&&!A(Y))){return}if(q(Y[aa])){return}if(Y[aa]!=null&&(Z===undefined||Z>0)){i(Y[aa],W,Z!==undefined?Z-1:Z)}H(Y,aa,W,Z);if(X&&(Z===undefined||Z>0)){j(Y,aa,W,Z)}};var z=function(){if(q(arguments[1])){o.apply(this,arguments)}else{if(A(arguments[1])){r.apply(this,arguments)}else{f.apply(this,arguments)}}};var o=function(Z,W){if(Z instanceof String||(!(Z instanceof Object)&&!A(Z))){return}if(A(Z)){var X=["__watchall__"];for(var aa=0;aa<Z.length;aa++){X.push(aa)}r(Z,X,W)}else{var Y=function(ad){var ac=[];for(var ab in ad){if(ad.hasOwnProperty(ab)){if(ad[ab] instanceof Object){Y(ad[ab])}else{ac.push(ab)}}}r(ad,ac,W)};Y(Z)}};var r=function(Z,Y,W){for(var X in Y){if(Y.hasOwnProperty(X)){f(Z,Y[X],W)}}};var V=[],t=null;function b(){t=null;for(var W=0;W<V.length;W++){V[W]()}V.length=0}var P=function(){if(!t){t=setTimeout(b)}return t};var l=function(W){if(t==null){P()}V[V.length]=W};var k=function(){var W=(q(arguments[2]))?E:T;W.apply(this,arguments)};var T=function(aa,ad,Y,X){var ac=null,ae=-1;var Z=A(aa);var W,ab=function(aj,ag,ah,af){var ai=P();if(ae!==ai){ae=ai;ac={type:"update"};ac.value=aa;ac.splices=null;l(function(){ad.call(this,ac);ac=null})}if(Z&&aa===this&&ac!==null){if(ag==="pop"||ag==="shift"){ah=[];af=[af]}else{if(ag==="push"||ag==="unshift"){ah=[ah];af=[]}else{if(ag!=="splice"){return}}}if(!ac.splices){ac.splices=[]}ac.splices[ac.splices.length]={index:aj,deleteCount:af?af.length:0,addedCount:ah?ah.length:0,added:ah,deleted:af}}};W=(Y==true)?undefined:0;i(aa,ab,W,X)};var E=function(Y,aa,Z,W,X){if(Y&&aa){U(Y,aa,function(af,ac,ab,ad){var ae={type:"update"};ae.value=ab;ae.oldvalue=ad;if(W&&N(ab)||A(ab)){T(ab,Z,W,X)}Z.call(this,ae)},0);if(W&&N(Y[aa])||A(Y[aa])){T(Y[aa],Z,W,X)}}};var H=function(ab,W,ae,X){var af=false;var aa=A(ab);if(!ab.watchers){v(ab,"watchers",{});if(aa){Q(ab,function(am,ak,ah,ag){M(ab,am,ak,ah,ag);if(X!==0&&ah&&(N(ah)||A(ah))){var al,aj,an,ao,ai=ab.watchers[W];if((ao=ab.watchers.__watchall__)){ai=ai?ai.concat(ao):ao}an=ai?ai.length:0;for(al=0;al<an;al++){if(ak!=="splice"){i(ah,ai[al],(X===undefined)?X:X-1)}else{for(aj=0;aj<ah.length;aj++){i(ah[aj],ai[al],(X===undefined)?X:X-1)}}}}})}}if(!ab.watchers[W]){ab.watchers[W]=[];if(!aa){af=true}}for(var ac=0;ac<ab.watchers[W].length;ac++){if(ab.watchers[W][ac]===ae){return}}ab.watchers[W].push(ae);if(af){var Y=ab[W];var ad=function(){return Y};var Z=function(aj,ak){var ai=Y;Y=aj;if(X!==0&&ab[W]&&(N(ab[W])||A(ab[W]))&&!ab[W].watchers){var ag,ah=ab.watchers[W].length;for(ag=0;ag<ah;ag++){i(ab[W],ab.watchers[W][ag],(X===undefined)?X:X-1)}}if(n(ab,W)){m(ab,W);return}if(!h.noMore){if(ai!==aj){if(!ak){F(ab,W,"set",aj,ai)}else{M(ab,W,"set",aj,ai)}h.noMore=false}}};if(h.useDirtyCheck){K(ab,W,Z)}else{e(ab,W,ad,Z)}}};var F=function(aa,W,Z,X,ad){if(W!==undefined){var ac,ae,Y=aa.watchers[W];if((ae=aa.watchers.__watchall__)){Y=Y?Y.concat(ae):ae}ac=Y?Y.length:0;for(var ab=0;ab<ac;ab++){Y[ab].call(aa,W,Z,X,ad)}}else{for(var W in aa){if(aa.hasOwnProperty(W)){F(aa,W,Z,X,ad)}}}};var L=["pop","push","reverse","shift","sort","slice","unshift","splice"];var D=function(Y,X,W,Z){v(Y,W,function(){var ad=0;var ae,af,ac,ab;if(W==="splice"){var ag=arguments[0];var aa=ag+arguments[1];ac=Y.slice(ag,aa);af=[];for(ae=2;ae<arguments.length;ae++){af[ae-2]=arguments[ae]}ad=ag}else{af=arguments.length>0?arguments[0]:undefined}ab=X.apply(Y,arguments);if(W!=="slice"){if(W==="pop"){ac=ab;ad=Y.length}else{if(W==="push"){ad=Y.length-1}else{if(W==="shift"){ac=ab}else{if(W!=="unshift"&&af===undefined){af=ab}}}}Z.call(Y,ad,W,af,ac)}return ab})};var Q=function(Y,Z){if(!q(Z)||!Y||(Y instanceof String)||(!A(Y))){return}for(var X=L.length,W;X--;){W=L[X];D(Y,Y[W],W,Z)}};var f=function(Z,aa,X){if(Z.watchers[aa]){if(X===undefined){delete Z.watchers[aa]}else{for(var Y=0;Y<Z.watchers[aa].length;Y++){var W=Z.watchers[aa][Y];if(W==X){Z.watchers[aa].splice(Y,1)}}}}G(Z,aa,X);d(Z,aa)};var C=function(X,Y){if(X.watchers){var W="__wjs_suspend__"+(Y!==undefined?Y:"");X.watchers[W]=true}};var n=function(W,X){return W.watchers&&(W.watchers.__wjs_suspend__||W.watchers["__wjs_suspend__"+X])};var m=function(W,X){l(function(){delete W.watchers.__wjs_suspend__;delete W.watchers["__wjs_suspend__"+X]})};var y=null;var M=function(Y,aa,Z,X,W){B[B.length]={obj:Y,prop:aa,mode:Z,newval:X,oldval:W};if(y===null){y=setTimeout(p)}};var p=function(){var X=null;y=null;for(var W=0;W<B.length;W++){X=B[W];F(X.obj,X.prop,X.mode,X.newval,X.oldval)}if(X){B=[];X=null}};var g=function(){for(var Y=0;Y<c.length;Y++){var W=c[Y];if(W.prop==="$$watchlengthsubjectroot"){var ab=J(W.obj,W.actual);if(ab.added.length||ab.removed.length){if(ab.added.length){u(W.obj,ab.added,W.watcher,W.level-1,true)}W.watcher.call(W.obj,"root","differentattr",ab,W.actual)}W.actual=x(W.obj)}else{var ab=J(W.obj[W.prop],W.actual);if(ab.added.length||ab.removed.length){if(ab.added.length){for(var X=0;X<W.obj.watchers[W.prop].length;X++){u(W.obj[W.prop],ab.added,W.obj.watchers[W.prop][X],W.level-1,true)}}F(W.obj,W.prop,"differentattr",ab,W.actual)}W.actual=x(W.obj[W.prop])}}var aa,Z;if(R.length>0){for(var Y=0;Y<R.length;Y++){aa=R[Y];Z=aa.object[aa.prop];if(!a(aa.orig,Z)){aa.orig=x(Z);aa.callback(Z)}}}};var a=function(X,W){var Y,Z=true;if(X!==W){if(N(X)){for(Y in X){if(!s&&Y==="watchers"){continue}if(X[Y]!==W[Y]){Z=false;break}}}else{Z=false}}return Z};var j=function(X,aa,W,Z){var Y;if(aa==="$$watchlengthsubjectroot"){Y=x(X)}else{Y=x(X[aa])}c.push({obj:X,prop:aa,actual:Y,watcher:W,level:Z})};var G=function(Z,aa,X){for(var Y=0;Y<c.length;Y++){var W=c[Y];if(W.obj==Z&&W.prop==aa&&W.watcher==X){c.splice(Y,1)}}};var d=function(Y,ab){var aa;for(var W=0;W<R.length;W++){var Z=R[W];var X=Z.object.watchers;aa=(Z.object==Y&&Z.prop==ab&&X&&(!X[ab]||X[ab].length==0));if(aa){R.splice(W,1)}}};h.watch=w;h.unwatch=z;h.callWatchers=F;h.suspend=C;h.onChange=k;I.watch=h;return I})(window.mag||{});var mag=(function(b){var a={modules:[],controllers:[],elements:[]};a.submodule=function(g,f){var d=function(h){return(g.controller||function(){}).apply(this,h)}.bind({},f);var c=function(i){if(arguments.length>1){f=f.concat([].slice.call(arguments,1))}var h=g.view.apply(g,f?[i].concat(f):[i]);if(f[0]&&f[0].key!=null){h.attrs.key=f[0].key}return h};d.$original=g.controller;var e={controller:d,view:c};if(f[0]&&f[0].key!=null){e.attrs={key:f[0].key}}return e};a.getArgs=function(d){var c=a.modules[d].controller&&a.modules[d].controller.$$args?[a.controllers[d]].concat(a.modules[d].controller.$$args):[a.controllers[d]];return c};b.mod=a;return b}(window.mag||{}));var mag=(function(f){var b={roots:[],templates:{},cache:{}};var c=[],d=[],e=0;function g(l,p,o){var m=p.getArgs(o);var n=p.modules[o];var k=p.controllers[o];n.view(l,k)}b.callConfigs=function(k){};var a=[];b.redraw=function(l,m,k){l=l||b.module||{};this.fun||(this.fun=i(function(){var t=false;if(t){return}t=true;var s;var p="__"+new Date+"__";for(var r=0,o;o=b.roots[r];r++){if(l.controllers[r]){var n=l.elements[r];console.time("Mag.JS:render:"+n.id);if(p in n){return}var q=l.getArgs(r);if(a[r]&&a[r]===JSON.stringify(q[0])){continue}g(n,l,r);k.watch(q[0],i(function(x,w,v,y){console.time("Mag.JS:re-render:"+x.id);var u=v.getArgs(w);if(a[w]!==JSON.stringify(u[0])){g(x,v,w);m.fill(x,u[0]);k.noMore=true;b.callConfigs(m.configs);s=JSON.stringify(u[0])}t=false;console.timeEnd("Mag.JS:re-render:"+x.id)}.bind(null,n,r,l)));m.fill(n,q[0]);b.callConfigs(m.configs);a[r]=JSON.stringify(q[0]);t=false;n[p]=true;console.timeEnd("Mag.JS:render:"+n.id)}}console.timeEnd("MagnumJS:init")}));this.fun()};var j=window.cancelAnimationFrame||window.clearTimeout;var h=window.requestAnimationFrame||window.setTimeout;var i=function(n,m){var l,k=m||16,o;return function(){if(+new Date-l>k||h===window.requestAnimationFrame){if(o>0){j(o)}o=h(function(){l=+new Date;n.apply(this,arguments)},k)}else{l=+new Date;n.apply(this,arguments)}}};f.render=b;return f}(window.mag||{}));var mag=(function(k,h,d){var e={},b=k.mod,a=k.render,j=k.fill,c,g=mag.watch;e.init=function(l,m){};e.redraw=function(){a.redraw(b||a.module||{},j,g)};e.withProp=function(m,l){return function(o){o=o||event;var n=o.currentTarget||this;l(m in n?n[m]:n.getAttribute(m))}};e.prop=function(l){var m=function(){if(arguments.length){l=arguments[0];e.redraw()}return l};m.type="fun";m.toJSON=function(){return JSON.parse(JSON.stringify(l))};return m};e.module=function(t,l,r){console.time("MagnumJS:init");var q=a.roots.indexOf(t);if(q<0){q=a.roots.length}var o=h.getElementById(t);if(!o){throw new Error("invalid node")}var u=o.parentNode;var n=o.cloneNode(true);var m=h.createElement("span");u.replaceChild(m,o);if(!l.view){throw new Error("view is required")}var s=b.submodule(l,[r]);a.roots[q]=t;var p=new s.controller;b.controllers[q]=p;b.modules[q]=s;b.elements[q]=n;e.redraw();u.replaceChild(n,m);if(p.onload){p.onload.call(null,n)}return{_type:"__mag__.module",_ele:t}};var i=function(l){return function(){return e[l].apply(this,arguments)}};var f=i("init");f.module=i("module");f.prop=i("prop");f.redraw=i("redraw");f.withProp=i("withProp");return f}(window.mag||{},document));
