<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="style.css">
  <script src="//rawgit.com/magnumjs/mag.js/master/new/dist/mag.0.8.5.min.js"></script>
</head>

<body>
 <!--   <xmp id="ProductCategoryRow2">
  <tr>
    <th colSpan="2">TEST</th>
  </tr>
</xmp>

<xmp id="ProductRow2" class="hide">
  <tr>
    <td class="name">NAME</td>
    <td class="price">PRICE</td>
  </tr>
</xmp>

<div id="ProductTable2">
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Price</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</div> -->

  <div id="ProductCategoryRow">
    <div class="row">
      <div class="row-header" colSpan="2">TEST</div>
    </div>
  </div>

  <div id="ProductRow" class="hide">
    <div class="row">
      <div class="row-cell name">NAME</div>
      <div class="row-cell price">PRICE</div>
    </div>
  </div>

  <div id="ProductTable">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Price</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>



  <div id="main">

    <h2>Navigation Menu</h2>
    <nav class="">
      <a href="#">Home</a>
    </nav>
    <p class="activated-hide">Please click a menu item</p>
  </div>

  <main id="hello">
    <h1>Say </h1>
    <input placeholder="test" value='tester' />


    <select>
      <option value="1">1</option>
      <option value="2">2</option>
    </select>
    <textarea></textarea>
    <button>Do</button>
    <div>
      <div class="item">
        <input type="checkbox" name="done" value="thingy" />
        <span></span>
      </div>
    </div>
  </main>

  <div id="test" class="hide">
    <button>click</button>
    <span class="test">default</span> 
    <span class="name"></span>
    <div id="passFail2" class="hide">
      <div class="messaging"></div>
    </div>
    <b>default</b>
  </div>

  <div id="contacts" class="hide">
    <h2></h2>
    <div id="form">
      <input name="name" />
      <input name="email" />
      <button>Save</button>
    </div>
    <ul id="list" class="hide">
      <li class="contact">
        <span class="name"></span>
      </li>
    </ul>
  </div>

  <div id="todos">
    <h3>Todos</h3>
    <div class="total">
      <b class="remaining"></b> 
      <span class="size"></span> 
      <a href="#">[archive]</a>
    </div>
    <ul>
      <li class="todoItem">
        <input type="checkbox" /><span class="text"></span>
      </li>
    </ul>
    <input placeholder="Add todo!">
    <button>Add</button>
  </div>

  <div id="build" class="hide">
    <a href="">Nested - module - build</a> 
    <div class="more"></div>
  </div>

  <div id="lister">
    <h2>Hello <span></span></h2>
    <ul>
      <li class="item"></li>
    </ul>
  </div>

  <div id="count">
    <button>Increment</button>
    count: <span class="count"></span>
  </div>

  <div id="modalCase">
    <div id="modal" class="hide">
      <section class="modal">
        <section class="wrapper">
        </section>
        <button class="close-modal">Close</button>
      </section>
    </div>
    <button>Open</button>
  </div>

  <div id="filter">
    <h3>List filter example</h3>
    <input placeholder="Filter list by something" />
    <ul class='hide'>
      <li>Person Name: <span class="name"></span>
      </li>
    </ul>
  </div>

  <div id="dashboard">
    <div id="filter-users">
      <h3>Filter users (<span data-bind="selectedUser"><name></name></span>)</h3>
      <input placeholder="Filter users by ... " />
      <ul>
        <li>Person Name: <span data-bind="name"></span>
        </li>
      </ul>
    </div>
    <div id="filter-projects">
      <h3>Filter projects (<span data-bind="selectedProject"><name></name></span>)</h3>
      <input placeholder="Filter projects by ... " />
      <ul>
        <li>Person Name: <span data-bind="name"></span>
        </li>
      </ul>
    </div>
  </div>

  <script>
    var ProductRow = {
      view: function(e, p, s) {
        var name = p.product.stocked ?
          p.product.name :
          p.product.name;

        s['row'] = p.product;
      }
    };
    var ProductCategoryRow = {
      view: function(e, p, s) {
        s['row-header'] = p.category;
      }
    };
    var ProductTable = {
      controller: function(p) {
        this.rows = []
      },
      view: function(e, p, s) {

        var lastCategory = null;
        var count = 0
        //s.tbody = s.rows
        var promises = []
        p.products.forEach(function(product) {

          if (product.category !== lastCategory) {

            var p = mag.module('ProductCategoryRow', ProductCategoryRow, {
              category: product.category
            }, 1);

            promises.push(p)

          }
          // var r = mag.module('ProductRow', ProductRow, {
          //  product: product
          //},1);
          // r.then(function(node) {
          //console.log(node.innerHTML) //Hello
          //})

          lastCategory = product.category;
          count++

        });

        Promise.all(promises).then(function(values) {

          s.tbody = values
        });
      }
    };
    var props = {
      products: [{
        category: "Sporting Goods",
        price: "$49.99",
        stocked: true,
        name: "Football"
      }, {
        category: "Sporting Goods",
        price: "$9.99",
        stocked: true,
        name: "Baseball"
      }, {
        category: "Sporting Goods",
        price: "$29.99",
        stocked: false,
        name: "Basketball"
      }, {
        category: "Electronics",
        price: "$99.99",
        stocked: true,
        name: "iPod Touch"
      }, {
        category: "Electronics",
        price: "$399.99",
        stocked: false,
        name: "iPhone 5"
      }, {
        category: "Electronics",
        price: "$199.99",
        stocked: true,
        name: "Nexus 7"
      }]
    };
    mag.module('ProductTable', ProductTable, props)

     var modal = {
      controller: function(props) {
        this.visible = mag.prop(props.visible)
      },
      view: function(element, props, state) {
        if (state.visible()) {
          element.classList.remove('hide')
          state.wrapper = {
            _html: props.content()
          }
        } else {
          element.classList.add('hide')
        }

        state.button = {
          _onclick: function() {
            state.visible(false)
          }
        }
      }
    }

    mag.module('modalCase', {
      view: function(element, props, state) {
        state.button = {
          _onclick: function() {
            mag.module('modal', modal, {
              visible: true,
              content: function() {
                return '<b>Hello Modal!</b>'
              }
            })
          }
        }
      }
    })

     mag.module("lister", {
      view: function(element, props, state) {
        var name1 = 'Yo!',
          name2 = 'Joe!'
        state.h2 = {
          _config: function(element, isNew, context) {
            context.onunload = function() {
              console.log('test')
            }
            state.span = name1
            state.item = [1, 2, 3]
            mag.redraw()
          },
          _onclick: function() {
            state.item.reverse()
            state.span = state.span == name1 && name2 || name1
          }
        }
      }
    })

     mag.module("lister", {
      view: function(element, props, state) {
        var name1 = 'Yo!',
          name2 = 'Joe!'
        state.h2 = {
          _config: function(element, isNew, context) {
            if (isNew) {
              state.span = name1
              state.item = [1, 2, 3]
              mag.redraw()
            }
          },
          _onclick: function() {
            state.item.reverse()
            state.span = state.span == name1 && name2 || name1;
          }
        }
      }
    })

     mag.module('lister3', {
      controller: function(props) {
        this.item = [1, 2, 3]
        this.title = 'Lister'
      },
      view: function(element, props, state) {
        state.h2 = {
          _text: state.title,
          _onclick: function() {
            state.show = state.show ? !state.show : true
            state.item.reverse()
            state.title = 'Gister' + state.show
          }
        }
      }
    })

     mag.module("count", {
      view: function(element, props, state) {
        state.button = {
          _onclick: function() {
            state.count = state.count + 1 || 1
          }
        }
      }
    })

     mag.module('hello', {
      controller: function(props) {
        this.onload = function(ele) {
          console.log('hello onload')
        }
        this.item = [{
          span: 'yo',
          _config: test
        }]

        function test(n, is, c, i) {
          console.log(is, i)
        }
        this.add = function() {
          //console.log(this.$done)
          this.item.push({
            span: 'test',
            _config: test
          })
          return false;
        }
      },
      view: function(element, props, state) {
        state.button = {
          _onclick: state.add.bind(state)
        }

        //state.h1 = '', 
        state.select = 2, state.textarea = 1
        //setTimeout(function() {
        //  console.log(state.h1, state.input)
        //}, 100)
      }
    })

    function merge(o1, o2) {
      for (var i in o2) {
        o1[i] = o2[i];
      }
      return o1;
    }

    mag.hookin('attributes', 'className', function(data) {
      data.value = data.node.classList + ' ' + data.value
      data.key = 'class'
    })

     mag.module("main", {
      controller: function() {
        this.h2 = {
          _text: 'Naver',
          _config: function(n, is, c, i) {
            c.count = c.count + 1 || 0
            c.onunload = function() {
              console.log(arguments)
            }
          }
        }
      },
      view: function(n, p, s) {
        s.a = p.menuItem
        s.p = {
          _className: 'test',
          _config: function(n, is, c, i) {
            //console.log('here1')
          }
        }

        s.$a = {
          _onclick: function() {
            console.log('clicked')
            s.h2 = null
          },
          _config: function(n, is, c, i) {
            console.log('here2')
          }
        }
      }
    }, {
      menuItem: ['HOME', 'PROJECTS', 'SERVICES', 'CONTACT']
    })
  </script>
  <script src="contacts.js"></script>
  <script src="filter.js"></script>
  <script src="script.js"></script>
</body>

</html>
